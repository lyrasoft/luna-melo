(self.webpackChunk_vue_entries_admin_segment_edit_ts=self.webpackChunk_vue_entries_admin_segment_edit_ts||[]).push([[532],{318:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var a=n(354),o=n.n(a),l=n(314),i=n.n(l)()(o());i.push([e.id,".c-option-item__wrapper[data-v-07a45fc1]{background:#fff;padding:0 10px 0 15px}.c-option-item__handle[data-v-07a45fc1]{padding:10px 15px 10px 0;border-right:1px solid var(--bs-border-color)}.c-option-item__handle>.fa-bars[data-v-07a45fc1]{line-height:24px}.c-option-item__content[data-v-07a45fc1]{width:100%}.c-option-item__content input[data-v-07a45fc1]{width:300px}.c-option-item__delete[data-v-07a45fc1]{margin-left:auto}","",{version:3,sources:["webpack://./vue/components/segment-edit/question/OptionEdit.vue"],names:[],mappings:"AAGE,yCACE,eAAA,CACA,qBAAA,CAGF,wCACE,wBAAA,CACA,6CAAA,CAEA,iDACE,gBAAA,CAIJ,yCACE,UAAA,CAEA,+CACE,WAAA,CAIJ,wCACE,gBAAA",sourcesContent:[".c-option-item__wrapper{background:#fff;padding:0 10px 0 15px}.c-option-item__handle{padding:10px 15px 10px 0;border-right:1px solid var(--bs-border-color)}.c-option-item__handle>.fa-bars{line-height:24px}.c-option-item__content{width:100%}.c-option-item__content input{width:300px}.c-option-item__delete{margin-left:auto}"],sourceRoot:""}]);const s=i},202:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var a=n(354),o=n.n(a),l=n(314),i=n.n(l)()(o());i.push([e.id,".c-question-item__wrapper[data-v-1dfbb147]{background:#fff;padding:0 10px 0 15px}.c-question-item__handle[data-v-1dfbb147]{padding:10px 15px 10px 0;border-right:1px solid var(--bs-border-color)}.c-question-item__handle>.fa-bars[data-v-1dfbb147]{line-height:24px}.c-question-item__content[data-v-1dfbb147]{flex-grow:1}.c-question-item__title[data-v-1dfbb147]{font-weight:700}.c-question-item__delete[data-v-1dfbb147]{margin-left:auto}.c-question-item #input-score[data-v-1dfbb147]{border-width:0 0 1px 0;border-color:#dee2e6;border-style:solid;text-align:center;width:60px;background:rgba(0,0,0,0)}","",{version:3,sources:["webpack://./vue/components/segment-edit/question/QuestionItem.vue"],names:[],mappings:"AAGE,2CACE,eAAA,CACA,qBAAA,CAGF,0CACE,wBAAA,CACA,6CAAA,CAEA,mDACE,gBAAA,CAIJ,2CACE,WAAA,CAGF,yCACE,eAAA,CAGF,0CACE,gBAAA,CAGF,+CACE,sBAAA,CACA,oBAAA,CACA,kBAAA,CACA,iBAAA,CACA,UAAA,CACA,wBAAA",sourcesContent:[".c-question-item__wrapper{background:#fff;padding:0 10px 0 15px}.c-question-item__handle{padding:10px 15px 10px 0;border-right:1px solid var(--bs-border-color)}.c-question-item__handle>.fa-bars{line-height:24px}.c-question-item__content{flex-grow:1}.c-question-item__title{font-weight:700}.c-question-item__delete{margin-left:auto}.c-question-item #input-score{border-width:0 0 1px 0;border-color:#dee2e6;border-style:solid;text-align:center;width:60px;background:rgba(0,0,0,0)}"],sourceRoot:""}]);const s=i},532:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>O});var a,o=n(508),l=n(88),i=n(923),s=n.n(i),r=n(671);function d(e){return e>100?100:e<1?1:e}!function(e){e.boolean="是非題",e.multiple="多選題",e.select="單選題"}(a||(a={}));const c={class:"c-question-item"},p={class:"c-question-item__wrapper d-flex border rounded-1 my-2"},m={class:"c-question-item__content d-flex align-items-center ms-2",style:{"min-width":"1px"}},v={class:"me-1 text-nowrap text-muted"},f={class:"text-nowrap me-1"},b={class:"d-flex align-items-center text-nowrap ms-auto"},_={class:"text-nowrap me-1 d-flex align-items-center"},A=(0,o.defineComponent)({__name:"QuestionItem",props:{item:{},index:{}},emits:["edit","delete","save"],setup(e,{emit:t}){const n=e,l=t,{item:i}=(0,o.toRefs)(n);function s(){l("edit",i.value)}function r(){l("delete",i.value.id)}const A=u.debounce((()=>{i.value.score=d(i.value.score),l("save",i.value)}),300);return(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createElementVNode)("div",c,[(0,o.createElementVNode)("div",p,[t[4]||(t[4]=(0,o.createElementVNode)("div",{class:"c-question-item__handle handle"},[(0,o.createElementVNode)("span",{class:"fal fa-bars"}),(0,o.createElementVNode)("span",{class:"sr-only"},"Drag")],-1)),(0,o.createElementVNode)("div",m,[(0,o.createElementVNode)("div",v,(0,o.toDisplayString)(n.index+1)+". ",1),(0,o.createElementVNode)("div",f,(0,o.toDisplayString)((0,o.unref)(a)[(0,o.unref)(i).type.replace("-","_")]),1),(0,o.createElementVNode)("a",{class:"c-question-item__title text-truncate pe-1 me-2",onClick:s},(0,o.toDisplayString)((0,o.unref)(i).content||"題目內容未填寫"),1),(0,o.createElementVNode)("div",b,[(0,o.createElementVNode)("div",_,[t[2]||(t[2]=(0,o.createElementVNode)("div",{class:"me-1"}," 分數 ",-1)),(0,o.createElementVNode)("div",null,[(0,o.withDirectives)((0,o.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.unref)(i).score=e),type:"number",id:"input-score",onInput:t[1]||(t[1]=(...e)=>(0,o.unref)(A)&&(0,o.unref)(A)(...e))},null,544),[[o.vModelText,(0,o.unref)(i).score]])])]),(0,o.createElementVNode)("div",{class:"c-question-item__delete"},[(0,o.createElementVNode)("a",{href:"javascript://",class:"btn c-delete-btn",onClick:r},t[3]||(t[3]=[(0,o.createElementVNode)("i",{class:"fal fa-trash"},null,-1)]))])])])])])]))}});n(545);var C=n(262);const x=(0,C.A)(A,[["__scopeId","data-v-1dfbb147"]]),V={class:"c-option-item"},w={class:"c-option-item__wrapper d-flex border rounded-1 my-2"},h={class:"c-option-item__content d-flex justify-content-between align-items-center ms-2",style:{"min-width":"1px"}},g={class:"text-nowrap me-1"},E={class:"d-flex align-items-center text-nowrap ms-auto"},y={class:"text-nowrap me-1 d-flex align-items-center"},N=(0,o.defineComponent)({__name:"OptionEdit",props:{item:{},index:{}},emits:["delete","edit","setAnswer"],setup(e,{emit:t}){const n=e,a=t,{item:l}=(0,o.toRefs)(n);function i(){a("delete",l.value.id)}const s=u.debounce((()=>{a("edit",l.value)}),300);function r(){a("setAnswer",n.index,l.value.isAnswer)}return(e,t)=>{const n=(0,o.resolveComponent)("BFormInput"),a=(0,o.resolveComponent)("BFormCheckbox");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createElementVNode)("div",V,[(0,o.createElementVNode)("div",w,[t[3]||(t[3]=(0,o.createElementVNode)("div",{class:"c-option-item__handle handle"},[(0,o.createElementVNode)("span",{class:"fal fa-bars"}),(0,o.createElementVNode)("span",{class:"sr-only"},"Drag")],-1)),(0,o.createElementVNode)("div",h,[(0,o.createElementVNode)("div",g,[(0,o.createVNode)(n,{modelValue:(0,o.unref)(l).title,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.unref)(l).title=e),placeholder:"輸入選項內容",onInput:(0,o.unref)(s)},null,8,["modelValue","onInput"])]),(0,o.createElementVNode)("div",E,[(0,o.createElementVNode)("div",y,[(0,o.createVNode)(a,{modelValue:(0,o.unref)(l).isAnswer,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,o.unref)(l).isAnswer=e),onChange:r,switch:""},null,8,["modelValue"])]),(0,o.createElementVNode)("div",{class:"c-option-item__delete"},[(0,o.createElementVNode)("a",{href:"javascript://",class:"btn c-delete-btn",onClick:i},t[2]||(t[2]=[(0,o.createElementVNode)("i",{class:"fal fa-trash"},null,-1)]))])])])])])])}}});n(141);const k=(0,C.A)(N,[["__scopeId","data-v-07a45fc1"]]),B={class:"c-image-uploader pb-3"},q={class:"c-image-uploader__card card overflow-hidden position-relative",style:{padding:"56.25% 0 0 0"}},I={key:0,class:"position-absolute",style:{top:"50%",left:"50%",width:"100%",height:"100%"}},F=["src"],U={class:"d-flex"},S={class:"me-2"},D={class:"d-none"},G=(0,o.defineComponent)({__name:"ImageUploader",props:{label:{},image:{}},emits:["uploaded","clear"],setup(e,{emit:t}){const n=e,a=t,l=(0,o.ref)(n.image),i=(0,o.ref)(""),s=((0,o.ref)(null),(0,o.ref)(!1)),r=(0,o.ref)();function d(){r.value.click()}async function c(e){await async function(e){if(null===e)return void alert("沒有上傳檔案");s.value=!0;let t=new FormData;t.append("file",e,e.name),t.append(u.data("csrf-token"),"1");const n=await u.$http.post(u.route("image_upload"),t,{headers:{"Content-Type":"multipart/form-data"}});l.value=n.data.data.url,a("uploaded",n.data.data.url),s.value=!1}(e.target.files[0])}function p(){l.value="",a("clear")}return(0,o.onMounted)((()=>{i.value=u.data("defaultImage")})),(e,t)=>{const a=(0,o.resolveComponent)("BSpinner"),u=(0,o.resolveComponent)("BButton");return(0,o.openBlock)(),(0,o.createElementBlock)("div",B,[(0,o.createElementVNode)("label",null,(0,o.toDisplayString)(n.label),1),(0,o.createElementVNode)("div",q,[s.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",I,[(0,o.createVNode)(a)])):((0,o.openBlock)(),(0,o.createElementBlock)("img",{key:1,class:"position-absolute",src:l.value||i.value,alt:"Preview",style:{top:"0",left:"0",width:"100%",height:"100%","object-fit":"cover"}},null,8,F))]),(0,o.createElementVNode)("div",U,[(0,o.createElementVNode)("div",S,[(0,o.createVNode)(u,{variant:"outline-primary",onClick:d},{default:(0,o.withCtx)((()=>t[0]||(t[0]=[(0,o.createTextVNode)(" 上傳檔案 ")]))),_:1})]),(0,o.createElementVNode)("div",null,[(0,o.createElementVNode)("button",{type:"button",class:"btn btn-outline-danger",onClick:p},t[1]||(t[1]=[(0,o.createElementVNode)("i",{class:"fal fa-trash"},null,-1)]))])]),(0,o.createElementVNode)("div",D,[(0,o.createElementVNode)("input",{ref_key:"fileInput",ref:r,type:"file",onChange:c,accept:"image/*"},null,544)])])}}}),$={key:2,class:"c-option-list mt-5"},M={class:"text-center mb-2 mt-3"},z=(0,o.defineComponent)({__name:"QuestionEdit",props:{question:{}},emits:["save"],setup(e,{emit:t}){const n=e,a=t,{question:l}=(0,o.toRefs)(n),i=((0,o.ref)(null),(0,o.ref)([])),c=[{text:"是非題",value:"boolean"},{text:"單選題",value:"select"},{text:"多選題",value:"multiple"}],p=[{text:"是",value:"1"},{text:"否",value:"0"}],m=["select","multiple"];(0,o.onMounted)((async()=>{-1!==m.indexOf(l.value.type)&&await f()}));const v=u.debounce((async()=>{l.value.score=d(l.value.score),a("save",l.value)}),300);async function f(){const e=u.$http.get(u.route("prepare_options"),{params:{question_id:l.value.id}});i.value=r.A.prepareList((await e).data.data)}async function b(){const e={};i.value.forEach(((t,n)=>{e[t.id]=n+1})),await u.$http.post(u.route("reorder_options"),{orders:e})}async function _(){const e={id:null,question_id:l.value.id,title:"",is_answer:0,state:1,ordering:i.value.length+1};await A(e,1),await f()}async function A(e,t=0){await u.$http.post(u.route("save_option"),{data:e,is_new:t})}async function C(e){await s()({title:"確定要刪除這個選項嗎？",icon:"warning",buttons:{cancel:{visible:!0,text:"取消"},confirm:{visible:!0,text:"確認"}}})&&(await u.$http.post(u.route("delete_option"),{id:e}),await f())}async function x(e,t){"select"===l.value.type&&(i.value.forEach((e=>{e.isAnswer=!1})),i.value[e].isAnswer=!0),"multiple"===l.value.type&&(i.value[e].isAnswer=t),t===i.value[e].isAnswer&&await u.$http.post(u.route("save_options"),{data:i.value})}function V(e){l.value.image=e,a("save",l.value)}function w(){l.value.image="",a("save",l.value)}return(0,o.watch)(l.value,(e=>{l.value.isMultiple="multiple"===e.type}),{deep:!0}),(e,t)=>{const n=(0,o.resolveComponent)("BFormTextarea"),a=(0,o.resolveComponent)("BFormGroup"),s=(0,o.resolveComponent)("BFormRadioGroup"),r=(0,o.resolveComponent)("BFormInput"),d=(0,o.resolveComponent)("draggable"),u=(0,o.resolveComponent)("BButton");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(a,{label:"題目內容編輯","label-for":"input-question-content","label-class":"mb-2",class:"mb-3"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(n,{id:"input-question-content",modelValue:(0,o.unref)(l).content,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,o.unref)(l).content=e),rows:"5"},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(a,{label:"題型","label-for":"input-question-type","label-class":"mb-2",class:"mb-3"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(s,{modelValue:(0,o.unref)(l).type,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,o.unref)(l).type=e),options:c,"button-variant":"outline-primary",name:"input-question-type",buttons:""},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(G,{image:(0,o.unref)(l).image,label:"上傳圖片(選填)",onUploaded:V,onClear:w},null,8,["image"]),"boolean"===(0,o.unref)(l).type?((0,o.openBlock)(),(0,o.createBlock)(a,{key:0,label:"答案","label-for":"input-question-answer","label-class":"mb-2",class:"mb-3"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(s,{modelValue:(0,o.unref)(l).answer,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,o.unref)(l).answer=e),options:p,"button-variant":"outline-primary",name:"input-question-answer",buttons:""},null,8,["modelValue"])])),_:1})):(0,o.createCommentVNode)("",!0),"cloze"===(0,o.unref)(l).type?((0,o.openBlock)(),(0,o.createBlock)(a,{key:1,label:"答案","label-for":"input-question-answer","label-class":"mb-2",class:"mb-3"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{id:"input-question-answer",modelValue:(0,o.unref)(l).answer,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,o.unref)(l).answer=e),type:"text",trim:""},null,8,["modelValue"])])),_:1})):(0,o.createCommentVNode)("",!0),-1!==m.indexOf((0,o.unref)(l).type)?((0,o.openBlock)(),(0,o.createElementBlock)("div",$,[t[7]||(t[7]=(0,o.createElementVNode)("div",{class:"d-flex"},[(0,o.createElementVNode)("div",{style:{width:"45px"}}),(0,o.createElementVNode)("div",{class:"text-center",style:{width:"300px"}}," 選項內容 "),(0,o.createElementVNode)("div",{class:"ms-3"}," 正確答案 ")],-1)),(0,o.createVNode)(d,{modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=e=>i.value=e),"item-key":"uid",handle:".handle",onChange:b},{item:(0,o.withCtx)((({element:e,index:t})=>[((0,o.openBlock)(),(0,o.createBlock)(k,{item:e,key:e.id,index:t,onDelete:C,onEdit:A,onSetAnswer:x},null,8,["item","index"]))])),_:1},8,["modelValue"]),(0,o.createElementVNode)("div",M,[(0,o.createVNode)(u,{onClick:_},{default:(0,o.withCtx)((()=>t[6]||(t[6]=[(0,o.createTextVNode)(" 新增選項 ")]))),_:1})])])):(0,o.createCommentVNode)("",!0),(0,o.createVNode)(a,{label:"配分","label-for":"input-question-score","label-class":"mb-2",class:"mb-3",description:"限填 1~100，測驗滿分為 100"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{id:"input-question-score",modelValue:(0,o.unref)(l).score,"onUpdate:modelValue":t[5]||(t[5]=e=>(0,o.unref)(l).score=e),type:"number",max:"100",min:"1",onInput:(0,o.unref)(v)},null,8,["modelValue","onInput"])])),_:1})])}}}),R={class:"c-quiz-edit"},T={key:0,class:"text-center"},j={key:1,class:"c-quiz-list"},O=(0,o.defineComponent)({__name:"SectionQuizEdit",props:{item:{}},setup(e){const t=e,n=(0,o.ref)(t.item),a=[{text:"可以",value:!0},{text:"不可以",value:!1}],i=(0,o.ref)([]),d=(0,o.ref)(),{show:c,hide:p}=(0,l.hS)("question-edit-modal"),m=(0,o.ref)(!1);async function v(){m.value=!0;const e=u.$http.get(u.route("prepare_questions"),{params:{segment_id:n.value.id}});i.value=r.A.prepareList((await e).data.data),m.value=!1}async function f(){const e={id:null,lesson_id:n.value.lessonId,segment_id:n.value.id,type:"select",is_multiple:"0",title:"",content:"",image:"",score:0,state:1,ordering:i.value.length+1};await V(e,1),await v()}async function b(){const e={};i.value.forEach(((t,n)=>{e[t.id]=n+1})),await u.$http.post(u.route("reorder_questions"),{orders:e})}function _(e){d.value=e,c()}async function A(e){await s()({title:"確定要刪除這個問題嗎？",icon:"warning",buttons:{cancel:{visible:!0,text:"取消"},confirm:{visible:!0,text:"確認"}}})&&(await u.$http.post(u.route("delete_question"),{id:e}),await v())}async function C(){await V(d.value,0),p()}async function V(e,t=0){await u.$http.post(u.route("save_question"),{data:e,isNew:t})}async function w(e){await V(e,0)}return(0,o.onMounted)((async()=>{await v()})),(e,t)=>{const l=(0,o.resolveComponent)("BFormInput"),s=(0,o.resolveComponent)("BFormGroup"),r=(0,o.resolveComponent)("BFormRadioGroup"),c=(0,o.resolveComponent)("BSpinner"),u=(0,o.resolveComponent)("draggable"),p=(0,o.resolveComponent)("BButton"),v=(0,o.resolveComponent)("BModal");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createVNode)(s,{label:"小節名稱編輯","label-for":"input-section-title","label-class":"mb-2",class:"mb-5"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(l,{id:"input-section-title",modelValue:n.value.title,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.title=e),trim:""},null,8,["modelValue"])])),_:1}),(0,o.createVNode)(s,{label:"是否可跳過此測驗閱讀下一章節？","label-for":"input-section-skip","label-class":"mb-2",class:"mb-5"},{default:(0,o.withCtx)((()=>[(0,o.createVNode)(r,{modelValue:n.value.canSkip,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.canSkip=e),options:a,"button-variant":"outline-primary",name:"input-section-skip",buttons:""},null,8,["modelValue"])])),_:1}),(0,o.createElementVNode)("div",R,[(0,o.createElementVNode)("div",{class:"d-flex justify-content-between align-items-center mb-3"},[t[4]||(t[4]=(0,o.createElementVNode)("div",{class:"h6 c-quiz-edit__title"}," 測驗內容 ",-1)),(0,o.createElementVNode)("div",null,[(0,o.createElementVNode)("button",{type:"button",class:"btn btn-info text-nowrap",onClick:f}," 新增題目 ")])]),m.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",T,[(0,o.createVNode)(c)])):((0,o.openBlock)(),(0,o.createElementBlock)("div",j,[(0,o.createVNode)(u,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value=e),"item-key":"uid",handle:".handle",onChange:b},{item:(0,o.withCtx)((({element:e,index:t})=>[((0,o.openBlock)(),(0,o.createBlock)(x,{item:e,key:e.id,index:t,onEdit:_,onDelete:A,onSave:w},null,8,["item","index"]))])),_:1},8,["modelValue"])]))]),(0,o.createVNode)(v,{id:"question-edit-modal","ok-only":"",bodyBgVariant:"light",contentClass:"bg-white",hideFooter:"true",lazy:"true","dialog-class":"mb-6",scrollable:"true",onHidden:t[3]||(t[3]=e=>w(d.value))},{title:(0,o.withCtx)((()=>[(0,o.createVNode)(p,{variant:"primary",size:"sm",onClick:C},{default:(0,o.withCtx)((()=>t[5]||(t[5]=[(0,o.createTextVNode)(" 儲存 ")]))),_:1})])),default:(0,o.withCtx)((()=>[(0,o.createVNode)(z,{question:d.value,onSave:w},null,8,["question"])])),_:1})])}}})},141:(e,t,n)=>{var a=n(318);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),(0,n(534).A)("27f40955",a,!0,{})},545:(e,t,n)=>{var a=n(202);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals),(0,n(534).A)("1d681586",a,!0,{})}}]);
//# sourceMappingURL=532.js.map