{"version":3,"file":"segment-editor.js","sources":["../../node_modules/bootstrap-vue-next/dist/orchestratorShared-BTC5xO6k.mjs","../../node_modules/bootstrap-vue-next/dist/src/composables/useRegistry/index.mjs","../../node_modules/bootstrap-vue-next/dist/src/plugins/rtl/index.mjs","../../node_modules/bootstrap-vue-next/dist/src/plugins/registry/index.mjs","../../node_modules/bootstrap-vue-next/dist/src/plugins/orchestrator/index.mjs","../../node_modules/bootstrap-vue-next/dist/src/plugins/createBootstrap/index.mjs","../../src/components/segment-edit/item/SectionItem.vue","../../src/components/segment-edit/item/SectionItem.vue","../../src/components/segment-edit/item/ChapterItem.vue","../../src/components/segment-edit/item/ChapterItem.vue","../../src/features/section/resolveSectionEditComponent.ts","../../src/components/segment-edit/SegmentEditBox.vue","../../src/components/segment-edit/SegmentEditBox.vue","../../src/components/segment-edit/SectionTypeSelector.vue","../../src/components/segment-edit/SectionTypeSelector.vue","../../src/app/admin/SegmentEditorApp.vue","../../src/app/admin/SegmentEditorApp.vue","../../src/segment-editor.ts"],"sourcesContent":["import { inject, ref, provide, nextTick, toValue } from \"vue\";\nimport { o as orchestratorRegistryKey } from \"./keys-BLeKMItg.mjs\";\nfunction buildPromise(_id, store) {\n  let resolveFunc = () => {\n  };\n  const promise = new Promise((resolve) => {\n    resolveFunc = resolve;\n  });\n  Object.assign(promise, {\n    id: _id,\n    ref: null,\n    show() {\n      const refWithMethods = this.ref;\n      if (refWithMethods?.show) {\n        refWithMethods.show();\n      } else return this.set({ modelValue: true });\n      return promise;\n    },\n    hide(trigger) {\n      const refWithMethods = this.ref;\n      if (refWithMethods?.hide) {\n        refWithMethods.hide(trigger, true);\n      } else return this.set({ modelValue: false });\n      return promise;\n    },\n    toggle() {\n      const currentItem = this.get();\n      const refWithMethods = this.ref;\n      if (refWithMethods?.toggle) {\n        refWithMethods.toggle();\n      } else return this.set({ modelValue: !currentItem?.modelValue });\n      return promise;\n    },\n    get() {\n      return store.value.find((el) => el._self === _id);\n    },\n    set(val) {\n      const itemIndex = store.value.findIndex((el) => el._self === _id);\n      const item = store.value[itemIndex];\n      if (item) {\n        const v = { ...toValue(item), ...toValue(val) };\n        if (item.modelValue !== v.modelValue) {\n          item[\"onUpdate:modelValue\"]?.(v.modelValue);\n        }\n        const updatedItem = {\n          ...v,\n          modelValue: toValue(v.modelValue)\n        };\n        const vRecord = v;\n        if (\"title\" in vRecord && vRecord.title !== void 0) {\n          updatedItem.title = toValue(vRecord.title);\n        }\n        if (\"body\" in vRecord && vRecord.body !== void 0) {\n          updatedItem.body = toValue(vRecord.body);\n        }\n        store.value.splice(itemIndex, 1, updatedItem);\n      }\n      return promise;\n    },\n    async destroy() {\n      const item = store.value.find((el) => el._self === _id);\n      if (!item) return;\n      item.promise.stop?.();\n      if (item.modelValue) {\n        await new Promise((resolve) => {\n          const prev = item[\"onHidden\"];\n          item[\"onHidden\"] = (e) => {\n            prev?.(e);\n            resolve(e);\n          };\n          nextTick(() => {\n            this.hide(\"destroy\");\n          });\n        });\n      }\n      store.value.splice(\n        store.value.findIndex((el) => el._self === _id),\n        1\n      );\n    },\n    async [Symbol.asyncDispose]() {\n      await this.destroy();\n    }\n  });\n  return {\n    value: promise,\n    resolve: resolveFunc,\n    stop: void 0\n  };\n}\nconst _newOrchestratorRegistry = () => ({\n  store: ref([]),\n  _isOrchestratorInstalled: ref(false),\n  _isToastAppend: ref(false)\n});\nconst useOrchestratorRegistry = () => {\n  const orchestratorRegistry = inject(orchestratorRegistryKey, void 0);\n  if (orchestratorRegistry) {\n    return orchestratorRegistry;\n  }\n  const newOrchestratorRegistry = _newOrchestratorRegistry();\n  provide(orchestratorRegistryKey, newOrchestratorRegistry);\n  return newOrchestratorRegistry;\n};\nexport {\n  _newOrchestratorRegistry as _,\n  buildPromise as b,\n  useOrchestratorRegistry as u\n};\n//# sourceMappingURL=orchestratorShared-BTC5xO6k.mjs.map\n","import { inject, provide, ref, computed, readonly } from \"vue\";\nimport { s as showHideRegistryKey, m as modalManagerKey, e as breadcrumbRegistryKey, a as breadcrumbGlobalIndexKey, r as rtlRegistryKey } from \"../../../keys-BLeKMItg.mjs\";\nconst useRegistry = (rtl = false) => {\n  const showHideStorage = inject(showHideRegistryKey, void 0);\n  if (!showHideStorage) {\n    const { register, values } = _newShowHideRegistry();\n    provide(showHideRegistryKey, { register, values });\n  }\n  const modalManager = inject(modalManagerKey, void 0);\n  if (!modalManager) {\n    const stack = ref(/* @__PURE__ */ new Map());\n    const countStack = computed(() => stack.value.size);\n    const valuesStack = computed(() => [...stack.value.values()]);\n    const lastStack = computed(() => valuesStack.value[valuesStack.value.length - 1]);\n    const pushStack = (modal) => {\n      stack.value.set(modal.uid, modal);\n    };\n    const removeStack = (modal) => {\n      stack.value.delete(modal.uid);\n    };\n    const registry = ref(/* @__PURE__ */ new Map());\n    const pushRegistry = (modal) => {\n      registry.value.set(modal.uid, modal);\n    };\n    const removeRegistry = (modal) => {\n      registry.value.delete(modal.uid);\n    };\n    provide(modalManagerKey, {\n      countStack,\n      lastStack,\n      registry: computed(() => registry.value),\n      stack: valuesStack,\n      pushStack,\n      removeStack,\n      pushRegistry,\n      removeRegistry\n    });\n  }\n  const breadcrumb = inject(breadcrumbRegistryKey, void 0);\n  if (!breadcrumb) {\n    const items = ref({\n      [breadcrumbGlobalIndexKey]: []\n    });\n    const reset = (key = breadcrumbGlobalIndexKey) => {\n      items.value[key] = [];\n    };\n    provide(breadcrumbRegistryKey, { items, reset });\n  }\n  const rtlRegistry = inject(rtlRegistryKey, void 0);\n  if (!rtlRegistry) {\n    const rtlDefault = false;\n    const localeDefault = void 0;\n    const rtlInitial = typeof rtl === \"boolean\" ? rtlDefault : rtl?.rtlInitial ?? rtlDefault;\n    const localeInitial = typeof rtl === \"boolean\" ? localeDefault : rtl?.localeInitial ?? localeDefault;\n    const isRtl = ref(rtlInitial);\n    const locale = ref(localeInitial);\n    provide(rtlRegistryKey, { isRtl, locale });\n  }\n};\nconst createGetActive = (instances) => () => instances.length > 0 ? instances[instances.length - 1] : void 0;\nconst _newShowHideRegistry = () => {\n  const values = ref(/* @__PURE__ */ new Map());\n  const register = ({\n    id,\n    component,\n    value,\n    toggle,\n    show,\n    hide,\n    registerTrigger,\n    unregisterTrigger\n  }) => {\n    let currentId = id;\n    const instanceValue = {\n      id,\n      component,\n      value: readonly(value),\n      toggle,\n      show,\n      hide,\n      registerTrigger,\n      unregisterTrigger\n    };\n    let instancesHolder = values.value.get(currentId);\n    if (!instancesHolder) {\n      const instances = [];\n      instancesHolder = {\n        instances,\n        // Returns the last mounted instance (most recent)\n        getActive: createGetActive(instances)\n      };\n      values.value.set(currentId, instancesHolder);\n    }\n    instancesHolder.instances.push(instanceValue);\n    const componentUid = component.uid;\n    return {\n      unregister() {\n        const holder = values.value.get(currentId);\n        if (!holder) return;\n        const index = holder.instances.findIndex(\n          (inst) => inst.component.uid === componentUid\n        );\n        if (index !== -1) {\n          holder.instances.splice(index, 1);\n        }\n        if (holder.instances.length === 0) {\n          values.value.delete(currentId);\n        }\n      },\n      updateId(newId, oldId) {\n        const holder = values.value.get(oldId);\n        if (!holder) return;\n        const instance = holder.instances.find(\n          (inst) => inst.component.uid === componentUid\n        );\n        if (!instance) return;\n        instance.id = newId;\n        let newHolder = values.value.get(newId);\n        if (!newHolder) {\n          const instances = [];\n          newHolder = {\n            instances,\n            getActive: createGetActive(instances)\n          };\n          values.value.set(newId, newHolder);\n        }\n        const index = holder.instances.findIndex(\n          (inst) => inst.component.uid === componentUid\n        );\n        if (index !== -1) {\n          holder.instances.splice(index, 1);\n          newHolder.instances.push(instance);\n        }\n        if (holder.instances.length === 0) {\n          values.value.delete(oldId);\n        }\n        currentId = newId;\n      }\n    };\n  };\n  return {\n    register,\n    values\n  };\n};\nexport {\n  _newShowHideRegistry,\n  useRegistry\n};\n//# sourceMappingURL=index.mjs.map\n","import { ref } from \"vue\";\nimport { r as rtlRegistryKey } from \"../../../keys-BLeKMItg.mjs\";\nconst rtlPlugin = {\n  install(app, options) {\n    const rtlDefault = false;\n    const localeDefault = void 0;\n    const rtlInitial = typeof options?.rtl === \"boolean\" ? rtlDefault : options?.rtl?.rtlInitial ?? rtlDefault;\n    const localeInitial = typeof options?.rtl === \"boolean\" ? localeDefault : options?.rtl?.localeInitial ?? localeDefault;\n    const isRtl = ref(rtlInitial);\n    const locale = ref(localeInitial);\n    app.provide(rtlRegistryKey, { isRtl, locale });\n  }\n};\nexport {\n  rtlPlugin\n};\n//# sourceMappingURL=index.mjs.map\n","import { s as showHideRegistryKey, a as breadcrumbGlobalIndexKey, e as breadcrumbRegistryKey, m as modalManagerKey } from \"../../../keys-BLeKMItg.mjs\";\nimport { _newShowHideRegistry } from \"../../composables/useRegistry/index.mjs\";\nimport { ref, computed } from \"vue\";\nconst registryPlugin = {\n  install(app) {\n    const { register, values } = _newShowHideRegistry();\n    app.provide(showHideRegistryKey, { register, values });\n    const items = ref({\n      [breadcrumbGlobalIndexKey]: []\n    });\n    const reset = (key = breadcrumbGlobalIndexKey) => {\n      items.value[key] = [];\n    };\n    app.provide(breadcrumbRegistryKey, { items, reset });\n    const stack = ref(/* @__PURE__ */ new Map());\n    const countStack = computed(() => stack.value.size);\n    const valuesStack = computed(() => [...stack.value.values()]);\n    const lastStack = computed(() => valuesStack.value[valuesStack.value.length - 1]);\n    const pushStack = (modal) => {\n      stack.value.set(modal.uid, modal);\n    };\n    const removeStack = (modal) => {\n      stack.value.delete(modal.uid);\n    };\n    const registry = ref(/* @__PURE__ */ new Map());\n    const pushRegistry = (modal) => {\n      registry.value.set(modal.uid, modal);\n    };\n    const removeRegistry = (modal) => {\n      registry.value.delete(modal.uid);\n    };\n    app.provide(modalManagerKey, {\n      countStack,\n      lastStack,\n      registry: computed(() => registry.value),\n      stack: valuesStack,\n      pushStack,\n      removeStack,\n      pushRegistry,\n      removeRegistry\n    });\n  }\n};\nexport {\n  registryPlugin\n};\n//# sourceMappingURL=index.mjs.map\n","import \"vue\";\nimport { o as orchestratorRegistryKey } from \"../../../keys-BLeKMItg.mjs\";\nimport { _ as _newOrchestratorRegistry } from \"../../../orchestratorShared-BTC5xO6k.mjs\";\nconst orchestratorPlugin = {\n  install(app) {\n    const orchestratorRegistry = _newOrchestratorRegistry();\n    app.provide(orchestratorRegistryKey, orchestratorRegistry);\n  }\n};\nexport {\n  orchestratorPlugin\n};\n//# sourceMappingURL=index.mjs.map\n","import { ref } from \"vue\";\nimport { rtlPlugin } from \"../rtl/index.mjs\";\nimport { registryPlugin } from \"../registry/index.mjs\";\nimport { orchestratorPlugin } from \"../orchestrator/index.mjs\";\nimport { f as defaultsKey } from \"../../../keys-BLeKMItg.mjs\";\nconst createBootstrap = (pluginData = {}) => ({\n  install(app) {\n    if ((pluginData.registries ?? true) === true) {\n      app.use(registryPlugin, pluginData);\n    }\n    if ((pluginData.rtl ?? true) === true || typeof pluginData.rtl === \"object\") {\n      app.use(rtlPlugin, pluginData);\n    }\n    if ((pluginData.orchestrator ?? true) === true) {\n      app.use(orchestratorPlugin);\n    }\n    const val = pluginData?.components ?? {};\n    app.provide(defaultsKey, ref(val));\n  }\n});\nexport {\n  createBootstrap\n};\n//# sourceMappingURL=index.mjs.map\n","<script setup lang=\"ts\">\r\nimport { deleteConfirm } from '@windwalker-io/unicorn-next';\r\nimport { vBTooltip } from 'bootstrap-vue-next';\r\nimport { inject, toRefs } from 'vue';\r\nimport { useSegmentController } from '~melo/features/segment/useSegmentController';\r\nimport { useSegmentEditor } from '~melo/features/segment/useSegmentEditor';\r\nimport { SectionDefine, Segment } from '~melo/types';\r\n\r\nconst props = defineProps<{\r\n  section: Segment;\r\n  chapterIndex: number;\r\n  sectionIndex: number;\r\n}>();\r\n\r\nconst emit = defineEmits<{\r\n  'edit': [section: Segment, sectionIndex: number];\r\n  'delete': [sectionId: number];\r\n  'save': [section: Segment];\r\n}>();\r\n\r\nconst { remove } = useSegmentController();\r\nconst { closeIfEditing } = useSegmentEditor();\r\n\r\nconst defines = inject<Record<string, SectionDefine>>('section.defines');\r\n\r\nconst {\r\n  edit,\r\n  isActive,\r\n} = useSegmentEditor();\r\n\r\nconst { section } = toRefs(props);\r\n\r\nasync function deleteSection() {\r\n  const v = await deleteConfirm(\r\n    '確定要刪除這個小節嗎？',\r\n    '如果刪除小節，關於小節所有資料都會遺失',\r\n    'warning',\r\n  );\r\n\r\n  if (v) {\r\n    await remove(section.value.id!);\r\n\r\n    closeIfEditing(section.value);\r\n\r\n    emit('delete', section.value.id!);\r\n  }\r\n}\r\n\r\nconst { save } = useSegmentController();\r\n\r\nfunction togglePreview() {\r\n  section.value.preview = !section.value.preview;\r\n\r\n  save(section.value);\r\n}\r\n\r\nfunction segmentTypeTitle(type: string) {\r\n  return defines?.[type]?.title || '未知類型';\r\n}\r\n\r\nfunction segmentTypeIcon(type: string) {\r\n  return defines?.[type]?.icon || 'fas fa-question-circle';\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"c-section-item-outside\" :data-id=\"section.id\">\r\n    <!-- Keep outside div to make animation work, since tabler card will break animation -->\r\n    <div class=\"card border bg-white\">\r\n      <!-- Bar -->\r\n      <div class=\"c-section-item card-body p-2\"\r\n        :class=\"{ 'bg-primary-subtle': isActive(section) }\">\r\n        <div class=\"c-section-item__content d-flex align-items-center gap-2 w-100\" style=\"min-width: 1px\">\r\n          <!-- Drag Handle -->\r\n          <div class=\"c-section-item__handle handle\" style=\"cursor: move; z-index: 3;\">\r\n            <span class=\"fal fa-bars\"></span>\r\n          </div>\r\n\r\n          <!-- Icon -->\r\n          <div v-b-tooltip=\"segmentTypeTitle(section.type)\" style=\"z-index: 3;\">\r\n            <i class=\"fa-fw\" :class=\"segmentTypeIcon(section.type)\"></i>\r\n          </div>\r\n\r\n          <!-- Serial -->\r\n          <div class=\"me-1\">\r\n            {{ props.chapterIndex + 1 }}.{{ props.sectionIndex + 1 }}\r\n          </div>\r\n\r\n          <!-- Title -->\r\n          <a href=\"#\" class=\"c-section-item__title text-truncate stretched-link text-decoration-none\"\r\n            @click.prevent=\"edit(section)\"\r\n          >\r\n            {{ section.title || '無標題小節' }}\r\n          </a>\r\n\r\n          <!-- Actions -->\r\n          <div class=\"c-section-item__actions ms-auto d-flex align-items-center gap-2\"\r\n            style=\"z-index: 3;\">\r\n            <div class=\"c-section-item__preview\">\r\n              <a href=\"javascript://\"\r\n                @click=\"togglePreview\"\r\n                class=\"btn btn-sm text-nowrap\"\r\n                :class=\"section.preview ? 'btn-warning' : 'btn-outline-secondary'\"\r\n                v-html=\"section.preview ? '可試閱' : '不可試閱'\"\r\n              >\r\n              </a>\r\n            </div>\r\n\r\n            <div class=\"c-section-item__delete\">\r\n              <a href=\"javascript://\" @click=\"deleteSection\">\r\n                <i class=\"fal fa-trash text-danger\"></i>\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { deleteConfirm } from '@windwalker-io/unicorn-next';\r\nimport { vBTooltip } from 'bootstrap-vue-next';\r\nimport { inject, toRefs } from 'vue';\r\nimport { useSegmentController } from '~melo/features/segment/useSegmentController';\r\nimport { useSegmentEditor } from '~melo/features/segment/useSegmentEditor';\r\nimport { SectionDefine, Segment } from '~melo/types';\r\n\r\nconst props = defineProps<{\r\n  section: Segment;\r\n  chapterIndex: number;\r\n  sectionIndex: number;\r\n}>();\r\n\r\nconst emit = defineEmits<{\r\n  'edit': [section: Segment, sectionIndex: number];\r\n  'delete': [sectionId: number];\r\n  'save': [section: Segment];\r\n}>();\r\n\r\nconst { remove } = useSegmentController();\r\nconst { closeIfEditing } = useSegmentEditor();\r\n\r\nconst defines = inject<Record<string, SectionDefine>>('section.defines');\r\n\r\nconst {\r\n  edit,\r\n  isActive,\r\n} = useSegmentEditor();\r\n\r\nconst { section } = toRefs(props);\r\n\r\nasync function deleteSection() {\r\n  const v = await deleteConfirm(\r\n    '確定要刪除這個小節嗎？',\r\n    '如果刪除小節，關於小節所有資料都會遺失',\r\n    'warning',\r\n  );\r\n\r\n  if (v) {\r\n    await remove(section.value.id!);\r\n\r\n    closeIfEditing(section.value);\r\n\r\n    emit('delete', section.value.id!);\r\n  }\r\n}\r\n\r\nconst { save } = useSegmentController();\r\n\r\nfunction togglePreview() {\r\n  section.value.preview = !section.value.preview;\r\n\r\n  save(section.value);\r\n}\r\n\r\nfunction segmentTypeTitle(type: string) {\r\n  return defines?.[type]?.title || '未知類型';\r\n}\r\n\r\nfunction segmentTypeIcon(type: string) {\r\n  return defines?.[type]?.icon || 'fas fa-question-circle';\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"c-section-item-outside\" :data-id=\"section.id\">\r\n    <!-- Keep outside div to make animation work, since tabler card will break animation -->\r\n    <div class=\"card border bg-white\">\r\n      <!-- Bar -->\r\n      <div class=\"c-section-item card-body p-2\"\r\n        :class=\"{ 'bg-primary-subtle': isActive(section) }\">\r\n        <div class=\"c-section-item__content d-flex align-items-center gap-2 w-100\" style=\"min-width: 1px\">\r\n          <!-- Drag Handle -->\r\n          <div class=\"c-section-item__handle handle\" style=\"cursor: move; z-index: 3;\">\r\n            <span class=\"fal fa-bars\"></span>\r\n          </div>\r\n\r\n          <!-- Icon -->\r\n          <div v-b-tooltip=\"segmentTypeTitle(section.type)\" style=\"z-index: 3;\">\r\n            <i class=\"fa-fw\" :class=\"segmentTypeIcon(section.type)\"></i>\r\n          </div>\r\n\r\n          <!-- Serial -->\r\n          <div class=\"me-1\">\r\n            {{ props.chapterIndex + 1 }}.{{ props.sectionIndex + 1 }}\r\n          </div>\r\n\r\n          <!-- Title -->\r\n          <a href=\"#\" class=\"c-section-item__title text-truncate stretched-link text-decoration-none\"\r\n            @click.prevent=\"edit(section)\"\r\n          >\r\n            {{ section.title || '無標題小節' }}\r\n          </a>\r\n\r\n          <!-- Actions -->\r\n          <div class=\"c-section-item__actions ms-auto d-flex align-items-center gap-2\"\r\n            style=\"z-index: 3;\">\r\n            <div class=\"c-section-item__preview\">\r\n              <a href=\"javascript://\"\r\n                @click=\"togglePreview\"\r\n                class=\"btn btn-sm text-nowrap\"\r\n                :class=\"section.preview ? 'btn-warning' : 'btn-outline-secondary'\"\r\n                v-html=\"section.preview ? '可試閱' : '不可試閱'\"\r\n              >\r\n              </a>\r\n            </div>\r\n\r\n            <div class=\"c-section-item__delete\">\r\n              <a href=\"javascript://\" @click=\"deleteSection\">\r\n                <i class=\"fal fa-trash text-danger\"></i>\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { uniqueItemList, uniqueItem } from '@lyrasoft/ts-toolkit/vue';\r\nimport {\r\n  deleteConfirm,\r\n  route,\r\n  sleep,\r\n  slideDown,\r\n  slideUp,\r\n  useHttpClient,\r\n  useUnicorn\r\n} from '@windwalker-io/unicorn-next';\r\nimport { BButton, BModal, BTooltip, vBTooltip } from 'bootstrap-vue-next';\r\nimport { SortableEvent } from 'sortablejs';\r\nimport swal from 'sweetalert';\r\nimport {\r\n  computed,\r\n  defineAsyncComponent,\r\n  inject, nextTick,\r\n  onMounted,\r\n  Ref,\r\n  ref,\r\n  shallowRef,\r\n  toRefs,\r\n  useTemplateRef,\r\n  watch\r\n} from 'vue';\r\nimport { DraggableEvent, VueDraggable } from 'vue-draggable-plus';\r\nimport { useSegmentController } from '~melo/features/segment/useSegmentController';\r\nimport { useSegmentEditor } from '~melo/features/segment/useSegmentEditor';\r\nimport SectionItem from './SectionItem.vue';\r\nimport TypeSelector from '../SectionTypeSelector.vue';\r\nimport type { Component } from 'vue';\r\nimport { Segment } from '~melo/types';\r\n\r\nconst props = defineProps<{\r\n  chapter: Segment;\r\n  index: number;\r\n}>();\r\n\r\nconst emit = defineEmits<{\r\n  'delete': [chapterId: number];\r\n}>()\r\n\r\nconst { save, reorder, remove } = useSegmentController();\r\nconst { closeIfEditing } = useSegmentEditor();\r\n\r\nconst chapter = ref(props.chapter);\r\n\r\n// Items\r\nconst sections = ref<(Segment & { uid?: string; })[]>(uniqueItemList(chapter.value?.children || []));\r\n\r\n// Open / Close\r\nconst isOpen = defineModel<boolean>('open', {\r\n  default: false,\r\n})\r\nconst slideDisplay = ref(isOpen.value ? 'display: flex;' : 'display: none;');\r\nconst sectionsContainer = useTemplateRef<HTMLDivElement>('sectionsContainer');\r\n\r\nwatch(isOpen, () => {\r\n  if (!sectionsContainer.value) {\r\n    return;\r\n  }\r\n\r\n  slideDisplay.value = '';\r\n\r\n  if (isOpen.value) {\r\n    slideDown(sectionsContainer.value, 300, 'flex')\r\n  } else {\r\n    slideUp(sectionsContainer.value);\r\n  }\r\n});\r\n\r\nfunction open() {\r\n  isOpen.value = true;\r\n}\r\n\r\nfunction close() {\r\n  isOpen.value = false;\r\n}\r\n\r\nfunction toggleOpen() {\r\n  isOpen.value = !isOpen.value;\r\n}\r\n\r\ndefineExpose({\r\n  open,\r\n  close,\r\n  toggleOpen,\r\n});\r\n\r\n// Edit\r\nconst {\r\n  isActive,\r\n  edit\r\n} = useSegmentEditor();\r\n\r\nconst u = useUnicorn();\r\n\r\nfunction newSection() {\r\n  u.trigger('section.new', chapter.value, newSectionSelected);\r\n}\r\n\r\nasync function newSectionSelected(section: Segment) {\r\n  const newSection = uniqueItem(section);\r\n  sections.value.push(newSection);\r\n\r\n  await nextTick();\r\n\r\n  edit(newSection);\r\n}\r\n\r\nasync function reorderSections() {\r\n  await reorder(sections.value);\r\n}\r\n\r\nasync function deleteSection(id: number) {\r\n  sections.value = sections.value.filter(s => s.id !== id);\r\n}\r\n\r\nasync function deleteChapter() {\r\n  const v = await deleteConfirm(\r\n    \"確定要刪除這個章節嗎？\",\r\n    \"如果刪除章節，關於章節所有資料都會遺失\",\r\n    \"warning\",\r\n  );\r\n\r\n  if (v) {\r\n    await remove(chapter.value.id!);\r\n\r\n    closeIfEditing(chapter.value);\r\n\r\n    emit('delete', chapter.value.id!);\r\n  }\r\n}\r\n\r\nasync function sectionMovedToHere(e: DraggableEvent<Segment>) {\r\n  const section = e.data;\r\n\r\n  section.parentId = chapter.value.id!;\r\n\r\n  await save(section);\r\n  await reorder(sections.value);\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"c-chapter-item-outside\">\r\n    <!-- Keep outside div to make animation work, since tabler card will break animation -->\r\n    <div class=\"card border\">\r\n      <!-- Bar -->\r\n      <div class=\"c-chapter-item card-body\"\r\n        :class=\"{ 'bg-primary-subtle': isActive(chapter) }\"\r\n      >\r\n        <div class=\"w-100\">\r\n          <div class=\"c-chapter-item__content d-flex align-items-center gap-2 w-100\" style=\"min-width: 1px\">\r\n            <div class=\"c-chapter-item__handle handle position-relative\" style=\"cursor: move; z-index: 3;\" >\r\n              <span class=\"fal fa-fw fa-bars\"></span>\r\n            </div>\r\n\r\n            <div style=\"z-index: 3;\">\r\n              <i class=\"fas fa-folder\"></i>\r\n            </div>\r\n\r\n            <div class=\"\">\r\n              {{ props.index + 1 }}.\r\n            </div>\r\n\r\n            <a href=\"#\"\r\n              class=\"c-chapter-item__title text-truncate stretched-link text-decoration-none\" @click.prevent=\"edit(chapter)\">\r\n              {{ chapter?.title || '(無章節名稱)' }}\r\n            </a>\r\n\r\n            <div class=\"c-chapter-item__actions ms-auto d-flex align-items-center gap-2\"\r\n              style=\"z-index: 3;\">\r\n            <span class=\"badge bg-secondary rounded-pill\">\r\n              {{ sections.length }}\r\n            </span>\r\n\r\n              <a href=\"javascript://\"\r\n                class=\"c-chapter-item__delete\"\r\n                v-b-tooltip=\"'刪除章節'\"\r\n                @click=\"deleteChapter\">\r\n                <i class=\"fal fa-trash text-danger\"></i>\r\n              </a>\r\n\r\n              <a href=\"javascript://\"\r\n                class=\"c-chapter-item__toggle\"\r\n                v-b-tooltip=\"'顯示/隱藏小節'\"\r\n                @click=\"toggleOpen\">\r\n                <i class=\"far\" :class=\"[isOpen ? 'fa-chevron-down' : 'fa-chevron-up']\"></i>\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div ref=\"sectionsContainer\" class=\"card-body bg-light flex-column gap-3\"\r\n        :style=\"slideDisplay\">\r\n        <!-- Sections -->\r\n        <div class=\"c-section-list\">\r\n          <VueDraggable\r\n            v-model=\"sections\"\r\n            item-key=\"uid\"\r\n            handle=\".handle\"\r\n            class=\"d-flex flex-column gap-2\"\r\n            group=\"sections\"\r\n            :animation=\"300\"\r\n            :on-add=\"sectionMovedToHere\"\r\n            :on-update=\"reorderSections\"\r\n          >\r\n            <TransitionGroup name=\"fade\">\r\n              <SectionItem\r\n                v-for=\"(element, index) in sections\"\r\n                :key=\"element.uid\"\r\n                :section=\"element\"\r\n                :chapterIndex=\"props.index\"\r\n                :sectionIndex=\"index\"\r\n                style=\"animation-duration: 300ms;\"\r\n                @delete=\"deleteSection\"\r\n              ></SectionItem>\r\n            </TransitionGroup>\r\n          </VueDraggable>\r\n        </div>\r\n\r\n        <div class=\"text-center\">\r\n          <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" @click=\"newSection\">\r\n            <i class=\"far fa-plus\"></i>\r\n            新增小節\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { uniqueItemList, uniqueItem } from '@lyrasoft/ts-toolkit/vue';\r\nimport {\r\n  deleteConfirm,\r\n  route,\r\n  sleep,\r\n  slideDown,\r\n  slideUp,\r\n  useHttpClient,\r\n  useUnicorn\r\n} from '@windwalker-io/unicorn-next';\r\nimport { BButton, BModal, BTooltip, vBTooltip } from 'bootstrap-vue-next';\r\nimport { SortableEvent } from 'sortablejs';\r\nimport swal from 'sweetalert';\r\nimport {\r\n  computed,\r\n  defineAsyncComponent,\r\n  inject, nextTick,\r\n  onMounted,\r\n  Ref,\r\n  ref,\r\n  shallowRef,\r\n  toRefs,\r\n  useTemplateRef,\r\n  watch\r\n} from 'vue';\r\nimport { DraggableEvent, VueDraggable } from 'vue-draggable-plus';\r\nimport { useSegmentController } from '~melo/features/segment/useSegmentController';\r\nimport { useSegmentEditor } from '~melo/features/segment/useSegmentEditor';\r\nimport SectionItem from './SectionItem.vue';\r\nimport TypeSelector from '../SectionTypeSelector.vue';\r\nimport type { Component } from 'vue';\r\nimport { Segment } from '~melo/types';\r\n\r\nconst props = defineProps<{\r\n  chapter: Segment;\r\n  index: number;\r\n}>();\r\n\r\nconst emit = defineEmits<{\r\n  'delete': [chapterId: number];\r\n}>()\r\n\r\nconst { save, reorder, remove } = useSegmentController();\r\nconst { closeIfEditing } = useSegmentEditor();\r\n\r\nconst chapter = ref(props.chapter);\r\n\r\n// Items\r\nconst sections = ref<(Segment & { uid?: string; })[]>(uniqueItemList(chapter.value?.children || []));\r\n\r\n// Open / Close\r\nconst isOpen = defineModel<boolean>('open', {\r\n  default: false,\r\n})\r\nconst slideDisplay = ref(isOpen.value ? 'display: flex;' : 'display: none;');\r\nconst sectionsContainer = useTemplateRef<HTMLDivElement>('sectionsContainer');\r\n\r\nwatch(isOpen, () => {\r\n  if (!sectionsContainer.value) {\r\n    return;\r\n  }\r\n\r\n  slideDisplay.value = '';\r\n\r\n  if (isOpen.value) {\r\n    slideDown(sectionsContainer.value, 300, 'flex')\r\n  } else {\r\n    slideUp(sectionsContainer.value);\r\n  }\r\n});\r\n\r\nfunction open() {\r\n  isOpen.value = true;\r\n}\r\n\r\nfunction close() {\r\n  isOpen.value = false;\r\n}\r\n\r\nfunction toggleOpen() {\r\n  isOpen.value = !isOpen.value;\r\n}\r\n\r\ndefineExpose({\r\n  open,\r\n  close,\r\n  toggleOpen,\r\n});\r\n\r\n// Edit\r\nconst {\r\n  isActive,\r\n  edit\r\n} = useSegmentEditor();\r\n\r\nconst u = useUnicorn();\r\n\r\nfunction newSection() {\r\n  u.trigger('section.new', chapter.value, newSectionSelected);\r\n}\r\n\r\nasync function newSectionSelected(section: Segment) {\r\n  const newSection = uniqueItem(section);\r\n  sections.value.push(newSection);\r\n\r\n  await nextTick();\r\n\r\n  edit(newSection);\r\n}\r\n\r\nasync function reorderSections() {\r\n  await reorder(sections.value);\r\n}\r\n\r\nasync function deleteSection(id: number) {\r\n  sections.value = sections.value.filter(s => s.id !== id);\r\n}\r\n\r\nasync function deleteChapter() {\r\n  const v = await deleteConfirm(\r\n    \"確定要刪除這個章節嗎？\",\r\n    \"如果刪除章節，關於章節所有資料都會遺失\",\r\n    \"warning\",\r\n  );\r\n\r\n  if (v) {\r\n    await remove(chapter.value.id!);\r\n\r\n    closeIfEditing(chapter.value);\r\n\r\n    emit('delete', chapter.value.id!);\r\n  }\r\n}\r\n\r\nasync function sectionMovedToHere(e: DraggableEvent<Segment>) {\r\n  const section = e.data;\r\n\r\n  section.parentId = chapter.value.id!;\r\n\r\n  await save(section);\r\n  await reorder(sections.value);\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"c-chapter-item-outside\">\r\n    <!-- Keep outside div to make animation work, since tabler card will break animation -->\r\n    <div class=\"card border\">\r\n      <!-- Bar -->\r\n      <div class=\"c-chapter-item card-body\"\r\n        :class=\"{ 'bg-primary-subtle': isActive(chapter) }\"\r\n      >\r\n        <div class=\"w-100\">\r\n          <div class=\"c-chapter-item__content d-flex align-items-center gap-2 w-100\" style=\"min-width: 1px\">\r\n            <div class=\"c-chapter-item__handle handle position-relative\" style=\"cursor: move; z-index: 3;\" >\r\n              <span class=\"fal fa-fw fa-bars\"></span>\r\n            </div>\r\n\r\n            <div style=\"z-index: 3;\">\r\n              <i class=\"fas fa-folder\"></i>\r\n            </div>\r\n\r\n            <div class=\"\">\r\n              {{ props.index + 1 }}.\r\n            </div>\r\n\r\n            <a href=\"#\"\r\n              class=\"c-chapter-item__title text-truncate stretched-link text-decoration-none\" @click.prevent=\"edit(chapter)\">\r\n              {{ chapter?.title || '(無章節名稱)' }}\r\n            </a>\r\n\r\n            <div class=\"c-chapter-item__actions ms-auto d-flex align-items-center gap-2\"\r\n              style=\"z-index: 3;\">\r\n            <span class=\"badge bg-secondary rounded-pill\">\r\n              {{ sections.length }}\r\n            </span>\r\n\r\n              <a href=\"javascript://\"\r\n                class=\"c-chapter-item__delete\"\r\n                v-b-tooltip=\"'刪除章節'\"\r\n                @click=\"deleteChapter\">\r\n                <i class=\"fal fa-trash text-danger\"></i>\r\n              </a>\r\n\r\n              <a href=\"javascript://\"\r\n                class=\"c-chapter-item__toggle\"\r\n                v-b-tooltip=\"'顯示/隱藏小節'\"\r\n                @click=\"toggleOpen\">\r\n                <i class=\"far\" :class=\"[isOpen ? 'fa-chevron-down' : 'fa-chevron-up']\"></i>\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div ref=\"sectionsContainer\" class=\"card-body bg-light flex-column gap-3\"\r\n        :style=\"slideDisplay\">\r\n        <!-- Sections -->\r\n        <div class=\"c-section-list\">\r\n          <VueDraggable\r\n            v-model=\"sections\"\r\n            item-key=\"uid\"\r\n            handle=\".handle\"\r\n            class=\"d-flex flex-column gap-2\"\r\n            group=\"sections\"\r\n            :animation=\"300\"\r\n            :on-add=\"sectionMovedToHere\"\r\n            :on-update=\"reorderSections\"\r\n          >\r\n            <TransitionGroup name=\"fade\">\r\n              <SectionItem\r\n                v-for=\"(element, index) in sections\"\r\n                :key=\"element.uid\"\r\n                :section=\"element\"\r\n                :chapterIndex=\"props.index\"\r\n                :sectionIndex=\"index\"\r\n                style=\"animation-duration: 300ms;\"\r\n                @delete=\"deleteSection\"\r\n              ></SectionItem>\r\n            </TransitionGroup>\r\n          </VueDraggable>\r\n        </div>\r\n\r\n        <div class=\"text-center\">\r\n          <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\" @click=\"newSection\">\r\n            <i class=\"far fa-plus\"></i>\r\n            新增小節\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n\r\n</style>\r\n","import { App, defineAsyncComponent } from 'vue';\r\nimport { useSectionEditComponents } from '~melo/features/section/useSectionEditComponents';\r\nimport { SectionDefine } from '~melo/types';\r\n\r\nexport function resolveSectionEditComponent(define: SectionDefine) {\r\n  if (define.vueComponentUrl) {\r\n    return defineAsyncComponent(() => import(/* @vite-ignore */ define.vueComponentUrl!));\r\n  }\r\n\r\n  if (define.vueComponentName) {\r\n    return define.vueComponentName;\r\n  }\r\n\r\n  const components = useSectionEditComponents();\r\n\r\n  return defineAsyncComponent(components[define.id]);\r\n}\r\n\r\n","<script setup lang=\"ts\">\r\nimport { BSpinner } from 'bootstrap-vue-next';\r\nimport { computed, defineAsyncComponent, nextTick, ref, watch } from 'vue';\r\nimport { resolveSectionEditComponent } from '~melo/features/section/resolveSectionEditComponent';\r\nimport { useSegmentEditor } from '~melo/features/segment/useSegmentEditor';\r\nimport { SectionDefine } from '~melo/types';\r\n\r\nconst props = defineProps<{\r\n  sectionDefines: Record<string, SectionDefine>;\r\n}>();\r\n\r\nconst {\r\n  isEditing,\r\n  segment,\r\n  type,\r\n  isChapter,\r\n  saving,\r\n  currentEditingId,\r\n} = useSegmentEditor();\r\n\r\nconst saved = ref(false);\r\n\r\nwatch(saving, (saving) => {\r\n  if (!saving) {\r\n    saved.value = true;\r\n  }\r\n});\r\n\r\nwatch(currentEditingId, () => {\r\n  saved.value = false;\r\n});\r\n\r\nconst editComponent = computed(() => {\r\n  if (!isEditing.value) {\r\n    return null;\r\n  }\r\n\r\n  if (isChapter.value) {\r\n    return defineAsyncComponent(() => import('~melo/components/segment-edit/chapter/ChapterEdit.vue'));\r\n  } else if (type.value) {\r\n    const define = props.sectionDefines[type.value];\r\n\r\n    return resolveSectionEditComponent(define);\r\n  }\r\n});\r\n\r\n// Focus\r\nconst editContainer = ref<HTMLDivElement>();\r\n\r\nwatch(editComponent, () => {\r\n  setTimeout(() => {\r\n    if (editComponent.value && editContainer.value) {\r\n      editContainer.value.querySelector<HTMLInputElement>('input[type=text]')?.focus();\r\n    }\r\n  }, 300);\r\n});\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"card position-sticky\" style=\"top: var(--melo-segment-edit-sticky-top, 100px);\">\r\n    <div class=\"card-header d-flex align-items-center justify-content-between\">\r\n      <div class=\"d-flex align-items-center gap-2\">\r\n        <h3 class=\"m-0\">\r\n          <template v-if=\"isChapter\">\r\n            編輯章節\r\n          </template>\r\n          <template v-else-if=\"isEditing\">\r\n            編輯小節\r\n          </template>\r\n          <template v-else>\r\n            編輯\r\n          </template>\r\n        </h3>\r\n        <div v-if=\"saving\" class=\"\">\r\n          <BSpinner small />\r\n          儲存中...\r\n        </div>\r\n        <div v-else-if=\"saved\" class=\"text-success\">\r\n          <i class=\"far fa-check\"></i>\r\n          已儲存\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Toolbar -->\r\n      <div v-if=\"isEditing\">\r\n        <span class=\"badge bg-warning\">\r\n          修改後會即時儲存\r\n        </span>\r\n        <!--<button type=\"button\" class=\"btn btn-primary btn-sm\" style=\"min-width: 120px;\">-->\r\n        <!--  <i class=\"fal fa-save\"></i>-->\r\n        <!--  儲存變更-->\r\n        <!--</button>-->\r\n        <!--<button type=\"button\" class=\"btn btn-outline-secondary btn-sm\">-->\r\n        <!--  <i class=\"fal fa-xmark\"></i>-->\r\n        <!--  取消-->\r\n        <!--</button>-->\r\n      </div>\r\n    </div>\r\n    <div ref=\"editContainer\" class=\"card-body\" v-if=\"segment && editComponent\">\r\n      <Component :is=\"editComponent\" v-model=\"segment\" />\r\n    </div>\r\n    <div v-else class=\"p-5 text-center\">\r\n      <div class=\"text-muted\" style=\"margin: 100px auto;\">\r\n        請選擇或新增章節以進行編輯\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { BSpinner } from 'bootstrap-vue-next';\r\nimport { computed, defineAsyncComponent, nextTick, ref, watch } from 'vue';\r\nimport { resolveSectionEditComponent } from '~melo/features/section/resolveSectionEditComponent';\r\nimport { useSegmentEditor } from '~melo/features/segment/useSegmentEditor';\r\nimport { SectionDefine } from '~melo/types';\r\n\r\nconst props = defineProps<{\r\n  sectionDefines: Record<string, SectionDefine>;\r\n}>();\r\n\r\nconst {\r\n  isEditing,\r\n  segment,\r\n  type,\r\n  isChapter,\r\n  saving,\r\n  currentEditingId,\r\n} = useSegmentEditor();\r\n\r\nconst saved = ref(false);\r\n\r\nwatch(saving, (saving) => {\r\n  if (!saving) {\r\n    saved.value = true;\r\n  }\r\n});\r\n\r\nwatch(currentEditingId, () => {\r\n  saved.value = false;\r\n});\r\n\r\nconst editComponent = computed(() => {\r\n  if (!isEditing.value) {\r\n    return null;\r\n  }\r\n\r\n  if (isChapter.value) {\r\n    return defineAsyncComponent(() => import('~melo/components/segment-edit/chapter/ChapterEdit.vue'));\r\n  } else if (type.value) {\r\n    const define = props.sectionDefines[type.value];\r\n\r\n    return resolveSectionEditComponent(define);\r\n  }\r\n});\r\n\r\n// Focus\r\nconst editContainer = ref<HTMLDivElement>();\r\n\r\nwatch(editComponent, () => {\r\n  setTimeout(() => {\r\n    if (editComponent.value && editContainer.value) {\r\n      editContainer.value.querySelector<HTMLInputElement>('input[type=text]')?.focus();\r\n    }\r\n  }, 300);\r\n});\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"card position-sticky\" style=\"top: var(--melo-segment-edit-sticky-top, 100px);\">\r\n    <div class=\"card-header d-flex align-items-center justify-content-between\">\r\n      <div class=\"d-flex align-items-center gap-2\">\r\n        <h3 class=\"m-0\">\r\n          <template v-if=\"isChapter\">\r\n            編輯章節\r\n          </template>\r\n          <template v-else-if=\"isEditing\">\r\n            編輯小節\r\n          </template>\r\n          <template v-else>\r\n            編輯\r\n          </template>\r\n        </h3>\r\n        <div v-if=\"saving\" class=\"\">\r\n          <BSpinner small />\r\n          儲存中...\r\n        </div>\r\n        <div v-else-if=\"saved\" class=\"text-success\">\r\n          <i class=\"far fa-check\"></i>\r\n          已儲存\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Toolbar -->\r\n      <div v-if=\"isEditing\">\r\n        <span class=\"badge bg-warning\">\r\n          修改後會即時儲存\r\n        </span>\r\n        <!--<button type=\"button\" class=\"btn btn-primary btn-sm\" style=\"min-width: 120px;\">-->\r\n        <!--  <i class=\"fal fa-save\"></i>-->\r\n        <!--  儲存變更-->\r\n        <!--</button>-->\r\n        <!--<button type=\"button\" class=\"btn btn-outline-secondary btn-sm\">-->\r\n        <!--  <i class=\"fal fa-xmark\"></i>-->\r\n        <!--  取消-->\r\n        <!--</button>-->\r\n      </div>\r\n    </div>\r\n    <div ref=\"editContainer\" class=\"card-body\" v-if=\"segment && editComponent\">\r\n      <Component :is=\"editComponent\" v-model=\"segment\" />\r\n    </div>\r\n    <div v-else class=\"p-5 text-center\">\r\n      <div class=\"text-muted\" style=\"margin: 100px auto;\">\r\n        請選擇或新增章節以進行編輯\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { SectionDefine } from '~melo/types';\r\n\r\nconst props = defineProps<{\r\n  sectionDefines: Record<string, SectionDefine>;\r\n}>();\r\n\r\nconst emit = defineEmits<{\r\n  selected: [type: string];\r\n}>();\r\n\r\nfunction select(type: string) {\r\n  emit('selected', type);\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"row row-cols-2 gy-3\">\r\n    <div v-for=\"(define, key) in sectionDefines\" :key=\"define.id\" class=\"col\">\r\n      <div class=\"c-section-button card border h-100\">\r\n        <div class=\"card-body d-flex flex-column gap-3\">\r\n          <div class=\"d-flex align-items-center gap-2\">\r\n            <i :class=\"define.icon\" style=\"font-size: 2rem;\"></i>\r\n            <a href=\"#\" class=\"link-dark text-decoration-none stretched-link\"\r\n              @click.prevent=\"select(key)\">\r\n              <h3 class=\"m-0\">\r\n                {{ define.title }}\r\n              </h3>\r\n            </a>\r\n          </div>\r\n          <div class=\"text-muted small\">{{ define.description }}</div>\r\n          <div class=\"mt-auto\">\r\n            <button type=\"button\" class=\"btn btn-outline-primary btn-sm\">\r\n              按此選擇\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.c-section-button {\r\n  transition: all .3s;\r\n\r\n  &:hover {\r\n    background-color: var(--bs-primary-bg-subtle);\r\n  }\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { SectionDefine } from '~melo/types';\r\n\r\nconst props = defineProps<{\r\n  sectionDefines: Record<string, SectionDefine>;\r\n}>();\r\n\r\nconst emit = defineEmits<{\r\n  selected: [type: string];\r\n}>();\r\n\r\nfunction select(type: string) {\r\n  emit('selected', type);\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"row row-cols-2 gy-3\">\r\n    <div v-for=\"(define, key) in sectionDefines\" :key=\"define.id\" class=\"col\">\r\n      <div class=\"c-section-button card border h-100\">\r\n        <div class=\"card-body d-flex flex-column gap-3\">\r\n          <div class=\"d-flex align-items-center gap-2\">\r\n            <i :class=\"define.icon\" style=\"font-size: 2rem;\"></i>\r\n            <a href=\"#\" class=\"link-dark text-decoration-none stretched-link\"\r\n              @click.prevent=\"select(key)\">\r\n              <h3 class=\"m-0\">\r\n                {{ define.title }}\r\n              </h3>\r\n            </a>\r\n          </div>\r\n          <div class=\"text-muted small\">{{ define.description }}</div>\r\n          <div class=\"mt-auto\">\r\n            <button type=\"button\" class=\"btn btn-outline-primary btn-sm\">\r\n              按此選擇\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.c-section-button {\r\n  transition: all .3s;\r\n\r\n  &:hover {\r\n    background-color: var(--bs-primary-bg-subtle);\r\n  }\r\n}\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { uniqueItemList } from '@lyrasoft/ts-toolkit/vue';\r\nimport { deleteConfirm, injectCssToDocument, simpleAlert, useUnicorn } from '@windwalker-io/unicorn-next';\r\nimport { BButton, BModal } from 'bootstrap-vue-next';\r\nimport { onErrorCaptured, onMounted, provide, ref } from 'vue';\r\nimport { VueDraggable } from 'vue-draggable-plus';\r\nimport ChapterItem from '~melo/components/segment-edit/item/ChapterItem.vue';\r\nimport SegmentEditBox from '~melo/components/segment-edit/SegmentEditBox.vue';\r\nimport TypeSelector from '~melo/components/segment-edit/SectionTypeSelector.vue';\r\nimport { useSegmentController } from '~melo/features/segment/useSegmentController';\r\nimport { useSegmentEditor } from '~melo/features/segment/useSegmentEditor';\r\nimport { QuestionDefine, SectionDefine, Segment } from '~melo/types';\r\n\r\nimport('@asika32764/vue-animate/dist/vue-animate.min.css?inline').then(({ default: css }) => {\r\n  injectCssToDocument(css);\r\n});\r\n\r\nonErrorCaptured((e) => {\r\n  simpleAlert('發生錯誤', e.message, 'warning');\r\n});\r\n\r\nconst props = defineProps<{\r\n  lessonId: number;\r\n  sectionDefines: Record<string, SectionDefine>;\r\n  questionDefines: Record<string, QuestionDefine>;\r\n  segments: Segment[];\r\n}>();\r\n\r\nprovide('section.defines', props.sectionDefines);\r\nprovide('question.defines', props.questionDefines);\r\n\r\nconst { reorder: reorderSegments, save: saveChapter, remove, createEmptyChapterItem } = useSegmentController();\r\nconst { edit, editById } = useSegmentEditor();\r\n\r\n// Replace single reactive state with separate refs\r\nconst items = ref<(Segment & { __open?: boolean; })[]>(prepareSegments(props.segments));\r\n\r\nonMounted(() => {\r\n  // Test\r\n  editById(244, items.value);\r\n});\r\n\r\nfunction prepareSegments(items: Segment[]) {\r\n  items = uniqueItemList(items);\r\n\r\n  for (const item of items) {\r\n    item.__open = false;\r\n  }\r\n\r\n  if (items[0]) {\r\n    items[0].__open = true;\r\n  }\r\n\r\n  return items;\r\n}\r\n\r\n// Create\r\nasync function newChapter() {\r\n  const chapter = createEmptyChapterItem(props.lessonId);\r\n\r\n  const newChapter = await saveChapter(chapter);\r\n\r\n  items.value.push(newChapter);\r\n\r\n  edit(newChapter);\r\n}\r\n\r\nasync function deleteChapter(id: number) {\r\n  items.value = items.value.filter(item => item.id !== id);\r\n}\r\n\r\nasync function reorder() {\r\n  reorderSegments(items.value);\r\n}\r\n\r\n// Open / Hide\r\nfunction toggleAllOpens() {\r\n  const allOpen = items.value.every(item => item.__open);\r\n\r\n  for (const item of items.value) {\r\n    item.__open = !allOpen;\r\n  }\r\n}\r\n\r\nconst u = useUnicorn();\r\n\r\n// Section Creating\r\nconst { createEmptySectionItem, save: saveSection } = useSegmentController();\r\nlet sectionSelectedCallback: ((section: Segment) => void) | null = null;\r\nlet currentChapter: Segment | null = null;\r\nconst sectionTypeSelectorModalOpen = ref(false);\r\n\r\nu.on('section.new', (chapter: Segment, callback: (section: Segment) => void) => {\r\n  currentChapter = chapter;\r\n  sectionSelectedCallback = callback;\r\n  sectionTypeSelectorModalOpen.value = true;\r\n});\r\n\r\nasync function sectionSelected(type: string) {\r\n  if (!currentChapter) {\r\n    return;\r\n  }\r\n\r\n  const section = createEmptySectionItem(currentChapter, type);\r\n  const savedSection = await saveSection(section, true);\r\n\r\n  sectionSelectedCallback?.(savedSection);\r\n\r\n  sectionTypeSelectorModalOpen.value = false;\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"container\">\r\n    <div class=\"row\">\r\n      <div class=\"col-lg-5\">\r\n        <div class=\"card mb-4\">\r\n          <div class=\"card-body d-flex align-items-center justify-content-between\">\r\n            <h4 class=\"bold my-1\">\r\n              課程章節 ({{ items.length }})\r\n            </h4>\r\n\r\n            <div>\r\n              <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\"\r\n                @click=\"toggleAllOpens\"\r\n              >\r\n                全體收合/展開\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"c-chapter-list\">\r\n          <VueDraggable\r\n            v-model=\"items\"\r\n            item-key=\"uid\"\r\n            handle=\".handle\"\r\n            class=\"d-flex flex-column gap-2\"\r\n            :animation=\"300\"\r\n            :on-update=\"reorder\"\r\n          >\r\n            <TransitionGroup name=\"fade\">\r\n              <ChapterItem v-for=\"(element, index) in items\"\r\n                :key=\"element.uid\"\r\n                :chapter=\"element\"\r\n                :index=\"index\"\r\n                v-model:open=\"element.__open\"\r\n                style=\"animation-duration: 300ms;\"\r\n                @delete=\"deleteChapter\"\r\n              ></ChapterItem>\r\n            </TransitionGroup>\r\n          </VueDraggable>\r\n        </div>\r\n\r\n        <div class=\"text-center my-4\">\r\n          <BButton variant=\"success\" @click=\"newChapter\">\r\n            <span class=\"fal fa-plus\"></span>\r\n            新增章節\r\n          </BButton>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"col-lg-7\">\r\n        <SegmentEditBox :sectionDefines />\r\n      </div>\r\n    </div>\r\n\r\n    <BModal v-model=\"sectionTypeSelectorModalOpen\"\r\n      title=\"選擇想要新增的小節類型\"\r\n      no-footer\r\n      lazy\r\n      unmount-lazy\r\n      size=\"lg\"\r\n    >\r\n      <TypeSelector :sectionDefines @selected=\"sectionSelected\" />\r\n    </BModal>\r\n\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n//@import \"@asika32764/vue-animate/dist/vue-animate.min.css\";\r\n</style>\r\n","<script setup lang=\"ts\">\r\nimport { uniqueItemList } from '@lyrasoft/ts-toolkit/vue';\r\nimport { deleteConfirm, injectCssToDocument, simpleAlert, useUnicorn } from '@windwalker-io/unicorn-next';\r\nimport { BButton, BModal } from 'bootstrap-vue-next';\r\nimport { onErrorCaptured, onMounted, provide, ref } from 'vue';\r\nimport { VueDraggable } from 'vue-draggable-plus';\r\nimport ChapterItem from '~melo/components/segment-edit/item/ChapterItem.vue';\r\nimport SegmentEditBox from '~melo/components/segment-edit/SegmentEditBox.vue';\r\nimport TypeSelector from '~melo/components/segment-edit/SectionTypeSelector.vue';\r\nimport { useSegmentController } from '~melo/features/segment/useSegmentController';\r\nimport { useSegmentEditor } from '~melo/features/segment/useSegmentEditor';\r\nimport { QuestionDefine, SectionDefine, Segment } from '~melo/types';\r\n\r\nimport('@asika32764/vue-animate/dist/vue-animate.min.css?inline').then(({ default: css }) => {\r\n  injectCssToDocument(css);\r\n});\r\n\r\nonErrorCaptured((e) => {\r\n  simpleAlert('發生錯誤', e.message, 'warning');\r\n});\r\n\r\nconst props = defineProps<{\r\n  lessonId: number;\r\n  sectionDefines: Record<string, SectionDefine>;\r\n  questionDefines: Record<string, QuestionDefine>;\r\n  segments: Segment[];\r\n}>();\r\n\r\nprovide('section.defines', props.sectionDefines);\r\nprovide('question.defines', props.questionDefines);\r\n\r\nconst { reorder: reorderSegments, save: saveChapter, remove, createEmptyChapterItem } = useSegmentController();\r\nconst { edit, editById } = useSegmentEditor();\r\n\r\n// Replace single reactive state with separate refs\r\nconst items = ref<(Segment & { __open?: boolean; })[]>(prepareSegments(props.segments));\r\n\r\nonMounted(() => {\r\n  // Test\r\n  editById(244, items.value);\r\n});\r\n\r\nfunction prepareSegments(items: Segment[]) {\r\n  items = uniqueItemList(items);\r\n\r\n  for (const item of items) {\r\n    item.__open = false;\r\n  }\r\n\r\n  if (items[0]) {\r\n    items[0].__open = true;\r\n  }\r\n\r\n  return items;\r\n}\r\n\r\n// Create\r\nasync function newChapter() {\r\n  const chapter = createEmptyChapterItem(props.lessonId);\r\n\r\n  const newChapter = await saveChapter(chapter);\r\n\r\n  items.value.push(newChapter);\r\n\r\n  edit(newChapter);\r\n}\r\n\r\nasync function deleteChapter(id: number) {\r\n  items.value = items.value.filter(item => item.id !== id);\r\n}\r\n\r\nasync function reorder() {\r\n  reorderSegments(items.value);\r\n}\r\n\r\n// Open / Hide\r\nfunction toggleAllOpens() {\r\n  const allOpen = items.value.every(item => item.__open);\r\n\r\n  for (const item of items.value) {\r\n    item.__open = !allOpen;\r\n  }\r\n}\r\n\r\nconst u = useUnicorn();\r\n\r\n// Section Creating\r\nconst { createEmptySectionItem, save: saveSection } = useSegmentController();\r\nlet sectionSelectedCallback: ((section: Segment) => void) | null = null;\r\nlet currentChapter: Segment | null = null;\r\nconst sectionTypeSelectorModalOpen = ref(false);\r\n\r\nu.on('section.new', (chapter: Segment, callback: (section: Segment) => void) => {\r\n  currentChapter = chapter;\r\n  sectionSelectedCallback = callback;\r\n  sectionTypeSelectorModalOpen.value = true;\r\n});\r\n\r\nasync function sectionSelected(type: string) {\r\n  if (!currentChapter) {\r\n    return;\r\n  }\r\n\r\n  const section = createEmptySectionItem(currentChapter, type);\r\n  const savedSection = await saveSection(section, true);\r\n\r\n  sectionSelectedCallback?.(savedSection);\r\n\r\n  sectionTypeSelectorModalOpen.value = false;\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <div class=\"container\">\r\n    <div class=\"row\">\r\n      <div class=\"col-lg-5\">\r\n        <div class=\"card mb-4\">\r\n          <div class=\"card-body d-flex align-items-center justify-content-between\">\r\n            <h4 class=\"bold my-1\">\r\n              課程章節 ({{ items.length }})\r\n            </h4>\r\n\r\n            <div>\r\n              <button type=\"button\" class=\"btn btn-outline-secondary btn-sm\"\r\n                @click=\"toggleAllOpens\"\r\n              >\r\n                全體收合/展開\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"c-chapter-list\">\r\n          <VueDraggable\r\n            v-model=\"items\"\r\n            item-key=\"uid\"\r\n            handle=\".handle\"\r\n            class=\"d-flex flex-column gap-2\"\r\n            :animation=\"300\"\r\n            :on-update=\"reorder\"\r\n          >\r\n            <TransitionGroup name=\"fade\">\r\n              <ChapterItem v-for=\"(element, index) in items\"\r\n                :key=\"element.uid\"\r\n                :chapter=\"element\"\r\n                :index=\"index\"\r\n                v-model:open=\"element.__open\"\r\n                style=\"animation-duration: 300ms;\"\r\n                @delete=\"deleteChapter\"\r\n              ></ChapterItem>\r\n            </TransitionGroup>\r\n          </VueDraggable>\r\n        </div>\r\n\r\n        <div class=\"text-center my-4\">\r\n          <BButton variant=\"success\" @click=\"newChapter\">\r\n            <span class=\"fal fa-plus\"></span>\r\n            新增章節\r\n          </BButton>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"col-lg-7\">\r\n        <SegmentEditBox :sectionDefines />\r\n      </div>\r\n    </div>\r\n\r\n    <BModal v-model=\"sectionTypeSelectorModalOpen\"\r\n      title=\"選擇想要新增的小節類型\"\r\n      no-footer\r\n      lazy\r\n      unmount-lazy\r\n      size=\"lg\"\r\n    >\r\n      <TypeSelector :sectionDefines @selected=\"sectionSelected\" />\r\n    </BModal>\r\n\r\n  </div>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n//@import \"@asika32764/vue-animate/dist/vue-animate.min.css\";\r\n</style>\r\n","import { createApp } from 'vue';\r\nimport SegmentEditorApp from '~melo/app/admin/SegmentEditorApp.vue';\r\nimport { createBootstrap } from 'bootstrap-vue-next';\r\nimport 'bootstrap-vue-next/dist/bootstrap-vue-next.css';\r\n\r\nexport function createSegmentEditorApp(props: Record<string, any>) {\r\n  const app = createApp(\r\n    SegmentEditorApp,\r\n    props\r\n  );\r\n\r\n  app.use(createBootstrap());\r\n\r\n  return app;\r\n}\r\n"],"names":["_hoisted_2","_hoisted_5","_hoisted_7","_createElementBlock","_createElementVNode","_normalizeClass","_hoisted_3","_withDirectives","_openBlock","_hoisted_4","_toDisplayString","_createTextVNode","_withModifiers","_hoisted_6","_hoisted_8","_useModel","newSection","_hoisted_1","_normalizeStyle","_createVNode","_TransitionGroup","_withCtx","_Fragment","_renderList","_createBlock","saving","_createCommentVNode","_resolveDynamicComponent","_hoisted_9","items","newChapter"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}