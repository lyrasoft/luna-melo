{"version":3,"file":"section-homework.js","sources":["../../src/modules/section-homework/SectionHomeworkApp.vue","../../src/modules/section-homework/section-homework.ts"],"sourcesContent":["<script setup lang=\"ts\">\n\nimport { useLoading } from '@lyrasoft/ts-toolkit/vue';\nimport { ApiReturn, data, simpleAlert, useHttpClient } from '@windwalker-io/unicorn-next';\nimport { Modal } from 'bootstrap';\nimport { onMounted, ref, useTemplateRef } from 'vue';\nimport { Segment } from '~melo/types';\n\nconst form = useTemplateRef<HTMLFormElement>('form');\nconst modalEl = useTemplateRef<HTMLDivElement>('modalEl');\nlet modal: Modal;\nconst chapterIndex = ref(0);\nconst sectionIndex = ref(0);\nconst typeIndex = ref(0);\nconst segmentId = ref(0);\nconst segmentTitle = ref('');\nconst currentSegment = ref<Segment>();\n\nonMounted(() => {\n  modal = Modal.getOrCreateInstance(modalEl.value!);\n  \n  const buttons = document.querySelectorAll<HTMLAnchorElement>('[data-task=\"start-homework\"]');\n\n  for (const button of buttons) {\n    button.addEventListener('click', async (e) => {\n      e.preventDefault();\n\n      await startHomework(button);\n\n      modal.show();\n    });\n  }\n});\n\nasync function startHomework(button: HTMLAnchorElement) {\n  segmentId.value = Number(button.dataset.segmentId);\n  segmentTitle.value = button.dataset.segmentTitle || '';\n  chapterIndex.value = Number(button.dataset.chapterIndex) || 0;\n  sectionIndex.value = Number(button.dataset.sectionIndex) || 0;\n  typeIndex.value = Number(button.dataset.typeIndex) || 0;\n\n  description.value = '';\n  file.value = undefined;\n  frontShow.value = true;\n\n  const { get } = await useHttpClient();\n\n  const res = await get<ApiReturn<Segment>>(`@ajax_lesson/getSegment?id=${segmentId.value}`);\n\n  currentSegment.value = res.data.data;\n}\n\n// Form\nconst { wrap, loading } = useLoading();\n\nconst description = ref('');\nconst file = ref<File>();\nconst frontShow = ref(true);\n\n\nconst submit = wrap(async () => {\n  const { post } = await useHttpClient();\n\n  try {\n    const formData = new FormData();\n    formData.append('item[segment_id]', segmentId.value.toString());\n    formData.append('item[description]', description.value);\n    if (file.value) {\n      formData.append('item[homework_file]', file.value);\n    }\n    formData.append('item[front_show]', frontShow.value ? '1' : '0');\n\n    const res = await post('@ajax_lesson/updateHomework', formData);\n\n    await simpleAlert('作業上傳成功！');\n\n    location.reload();\n\n  } catch (e) {\n    console.error(e);\n    await simpleAlert('作業上傳失敗');\n  }\n});\n</script>\n\n<template>\n<div>\n  <div ref=\"modalEl\" class=\"modal fade c-homework-modal\" id=\"homework-modal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h4 class=\"modal-title\">\n            作業上傳\n          </h4>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"modal-body\">\n          <form v-if=\"currentSegment\" id=\"homework-form\" enctype=\"multipart/form-data\" method=\"post\"\n            ref=\"form\"\n            >\n            <h6>\n              作業標題\n            </h6>\n\n            <div class=\"mb-4 text-muted j-homework-title\">\n              {{ segmentTitle }}\n            </div>\n\n            <h6>\n              章節\n            </h6>\n\n            <div class=\"mb-4 text-muted j-homework-index\">\n              第 {{ chapterIndex }} 章 作業 {{ typeIndex }}\n            </div>\n\n            <h6>\n              敘述\n            </h6>\n\n            <div class=\"mb-4 text-muted j-homework-content\" v-html=\"currentSegment.content\"></div>\n\n            <h6>\n              作業敘述\n            </h6>\n\n            <div class=\"mb-4\">\n              <textarea class=\"form-control\" name=\"item[description]\" placeholder=\"寫下作業敘述...\"\n                v-model=\"description\"\n                rows=\"5\"></textarea>\n            </div>\n\n            <div class=\"mb-4\">\n              <div class=\"form-group\">\n                <label for=\"input-homework-file\" class=\"form-label\">上傳檔案</label>\n                <input class=\"form-control\" type=\"file\" id=\"input-homework-file\" name=\"item[homework_file]\"\n                  accept=\".pdf,.jpg,.png,.doc,.docx\"\n                  @change=\"(e) => file = e.target?.files[0]\"\n                >\n              </div>\n            </div>\n\n            <div class=\"mb-4 pb-3\">\n              <div class=\"form-check\">\n                <input class=\"form-check-input\" type=\"radio\" name=\"item[front_show]\" id=\"front-show-true\"\n                  v-model=\"frontShow\"\n                  :value=\"true\">\n                <label class=\"form-check-label\" for=\"front-show-true\">\n                  公開在前台\n                </label>\n              </div>\n              <div class=\"form-check\">\n                <input class=\"form-check-input\" type=\"radio\" name=\"item[front_show]\" id=\"front-show-false\"\n                  v-model=\"frontShow\"\n                  :value=\"false\">\n                <label class=\"form-check-label\" for=\"front-show-false\">\n                  不公開在前台\n                </label>\n              </div>\n            </div>\n\n            <input type=\"hidden\" class=\"j-homework-section-id\" name=\"item[segment_id]\" :value=\"segmentId\">\n            <!--<input type=\"hidden\" name=\"anticsrf\" :value=\"csrf\">-->\n\n            <div class=\"d-grid gap-2 mx-4 mb-5\">\n              <button type=\"button\" class=\"btn btn-primary j-homework-submit\"\n                :disabled=\"loading\"\n                @click=\"submit\">\n                確認送出\n              </button>\n              <button type=\"button\" class=\"btn btn-outline-primary\" data-bs-dismiss=\"modal\"\n                :disabled=\"loading\">\n                先跳過此節\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n\n</div>\n</template>\n\n<style scoped>\n\n</style>\n","import { createApp } from 'vue';\nimport SectionHomeworkApp from '~melo/modules/section-homework/SectionHomeworkApp.vue';\n\nexport async function createSectionHomeworkApp(props: Record<string, any>) {\n  const app = createApp(SectionHomeworkApp, props);\n\n  return app;\n}\n\n"],"names":["_createElementBlock","_createElementVNode","_createTextVNode","_openBlock","_toDisplayString","_withDirectives"],"mappings":";;;;;;;;;AAQA,UAAM,OAAO,eAAgC,MAAM;AACnD,UAAM,UAAU,eAA+B,SAAS;AACxD,QAAI;AACJ,UAAM,eAAe,IAAI,CAAC;AAC1B,UAAM,eAAe,IAAI,CAAC;AAC1B,UAAM,YAAY,IAAI,CAAC;AACvB,UAAM,YAAY,IAAI,CAAC;AACvB,UAAM,eAAe,IAAI,EAAE;AAC3B,UAAM,iBAAiB,IAAA;AAEvB,cAAU,MAAM;AACd,cAAQ,MAAM,oBAAoB,QAAQ,KAAM;AAEhD,YAAM,UAAU,SAAS,iBAAoC,8BAA8B;AAE3F,iBAAW,UAAU,SAAS;AAC5B,eAAO,iBAAiB,SAAS,OAAO,MAAM;AAC5C,YAAE,eAAA;AAEF,gBAAM,cAAc,MAAM;AAE1B,gBAAM,KAAA;AAAA,QACR,CAAC;AAAA,MACH;AAAA,IACF,CAAC;AAED,mBAAe,cAAc,QAA2B;AACtD,gBAAU,QAAQ,OAAO,OAAO,QAAQ,SAAS;AACjD,mBAAa,QAAQ,OAAO,QAAQ,gBAAgB;AACpD,mBAAa,QAAQ,OAAO,OAAO,QAAQ,YAAY,KAAK;AAC5D,mBAAa,QAAQ,OAAO,OAAO,QAAQ,YAAY,KAAK;AAC5D,gBAAU,QAAQ,OAAO,OAAO,QAAQ,SAAS,KAAK;AAEtD,kBAAY,QAAQ;AACpB,WAAK,QAAQ;AACb,gBAAU,QAAQ;AAElB,YAAM,EAAE,QAAQ,MAAM,cAAA;AAEtB,YAAM,MAAM,MAAM,IAAwB,8BAA8B,UAAU,KAAK,EAAE;AAEzF,qBAAe,QAAQ,IAAI,KAAK;AAAA,IAClC;AAGA,UAAM,EAAE,MAAM,QAAA,IAAY,WAAA;AAE1B,UAAM,cAAc,IAAI,EAAE;AAC1B,UAAM,OAAO,IAAA;AACb,UAAM,YAAY,IAAI,IAAI;AAG1B,UAAM,SAAS,KAAK,YAAY;AAC9B,YAAM,EAAE,SAAS,MAAM,cAAA;AAEvB,UAAI;AACF,cAAM,WAAW,IAAI,SAAA;AACrB,iBAAS,OAAO,oBAAoB,UAAU,MAAM,UAAU;AAC9D,iBAAS,OAAO,qBAAqB,YAAY,KAAK;AACtD,YAAI,KAAK,OAAO;AACd,mBAAS,OAAO,uBAAuB,KAAK,KAAK;AAAA,QACnD;AACA,iBAAS,OAAO,oBAAoB,UAAU,QAAQ,MAAM,GAAG;AAE/D,cAAM,MAAM,MAAM,KAAK,+BAA+B,QAAQ;AAE9D,cAAM,YAAY,SAAS;AAE3B,iBAAS,OAAA;AAAA,MAEX,SAAS,GAAG;AACV,gBAAQ,MAAM,CAAC;AACf,cAAM,YAAY,QAAQ;AAAA,MAC5B;AAAA,IACF,CAAC;;;;;;;;;;;EAKM,KAAI;AAAA,EAAU,OAAM;AAAA,EAA8B,IAAG;AAAA,EAAiB,UAAS;AAAA,EAAK,eAAY;;AAC9F,MAAA,aAAA,EAAA,OAAM,eAAA;AACJ,MAAA,aAAA,EAAA,OAAM,gBAAA;AAOJ,MAAA,aAAA,EAAA,OAAM,aAAA;;;EACmB,IAAG;AAAA,EAAgB,SAAQ;AAAA,EAAsB,QAAO;AAAA,EAClF,KAAI;;AAMC,MAAA,aAAA,EAAA,OAAM,mCAAA;AAQN,MAAA,aAAA,EAAA,OAAM,mCAAA;;AAcN,MAAA,aAAA,EAAA,OAAM,OAAA;AAMN,MAAA,cAAA,EAAA,OAAM,OAAA;AACJ,MAAA,cAAA,EAAA,OAAM,aAAA;AASR,MAAA,cAAA,EAAA,OAAM,YAAA;AACJ,MAAA,cAAA,EAAA,OAAM,aAAA;AAQN,MAAA,cAAA,EAAA,OAAM,aAAA;;AAaR,MAAA,cAAA,EAAA,OAAM,yBAAA;;;;sBA9EvBA,mBA+FM,OAAA,MAAA;AAAA,IA9FJC,mBA4FM,OA5FN,YA4FM;AAAA,MA3FJA,mBA0FM,OA1FN,YA0FM;AAAA,QAzFJA,mBAwFM,OAxFN,YAwFM;AAAA,UAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IAvFJA,mBAKM,OAAA,EALD,OAAM,kBAAc;AAAA,YACvBA,mBAEK,MAAA,EAFD,OAAM,cAAA,GAAc,gCAExB;AAAA,YAAAC,gBAAA;AAAA,YACAD,mBAA4F,UAAA;AAAA,cAApF,MAAK;AAAA,cAAS,OAAM;AAAA,cAAY,mBAAgB;AAAA,cAAQ,cAAW;AAAA,YAAA,CAAA;AAAA;;UAE7EA,mBAgFM,OAhFN,YAgFM;AAAA,YA/EQ,OAAA,kBAAAE,UAAA,GAAZH,mBA8EO,QA9EP,YA8EO;AAAA,cAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IA3ELC,mBAEK,YAFD,sCAEJ,EAAA;AAAA,cAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAC,gBAAA;AAAA,cAEAD,mBAEM,OAFN,YAEMG,gBADD,OAAA,YAAY,GAAA,CAAA;AAAA,cAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAF,gBAAA;AAAA,cAGjB,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAD,mBAEK,YAFD,oCAEJ,EAAA;AAAA,cAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAC,gBAAA;AAAA,cAEAD,mBAEM,OAFN,YAA8C,uBAC1CG,gBAAG,mBAAY,IAAG,WAAMA,gBAAG,OAAA,SAAS,GAAA,CAAA;AAAA,cAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAF,gBAAA;AAAA,cAGxC,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAD,mBAEK,YAFD,oCAEJ,EAAA;AAAA,cAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAC,gBAAA;AAAA,cAEAD,mBAAsF,OAAA;AAAA,gBAAjF,OAAM;AAAA,gBAAqC,WAAQ,OAAA,eAAe;AAAA,cAAA,GAAA,MAAA,GAAA,UAAA;AAAA;cAEvE,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAA,mBAEK,YAFD,sCAEJ,EAAA;AAAA,cAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAC,gBAAA;AAAA,cAEAD,mBAIM,OAJN,YAIM;AAAA,gBAAAI,eAHJJ,mBAEsB,YAAA;AAAA,kBAFZ,OAAM;AAAA,kBAAe,MAAK;AAAA,kBAAoB,aAAY;AAAA,kBAAA,uBAAA,OAAA,CAAA,MAAA,OAAA,CAAA,IAAA,CAAA,WACzD,OAAA,cAAW;AAAA,kBACpB,MAAK;AAAA,gBAAA,GAAA,MAAA,GAAA,GAAA;AAAA,+BADI,OAAA,WAAW;AAAA,gBAAA,CAAA;AAAA;;cAIxBA,mBAQM,OARN,aAQM;AAAA,gBAPJA,mBAMM,OANN,aAMM;AAAA,kBAAA,OAAA,CAAA,MAAA,OAAA,CAAA,IALJA,mBAAgE,SAAA;AAAA,oBAAzD,KAAI;AAAA,oBAAsB,OAAM;AAAA,kBAAA,GAAa,QAAI,EAAA;AAAA,kBAAA,OAAA,CAAA,MAAA,OAAA,CAAA,IAAAC,gBAAA;AAAA,kBACxDD,mBAGC,SAAA;AAAA,oBAHM,OAAM;AAAA,oBAAe,MAAK;AAAA,oBAAO,IAAG;AAAA,oBAAsB,MAAK;AAAA,oBACpE,QAAO;AAAA,oBACN,UAAM,OAAA,CAAA,MAAA,OAAA,CAAA,IAAA,CAAG,MAAM,OAAA,OAAO,EAAE,QAAQ,MAAK,CAAA;AAAA,kBAAA,GAAA,MAAA,EAAA;AAAA;;;cAK5CA,mBAiBM,OAjBN,aAiBM;AAAA,gBAhBJA,mBAOM,OAPN,aAOM;AAAA,kBAAAI,eANJJ,mBAEgB,SAAA;AAAA,oBAFT,OAAM;AAAA,oBAAmB,MAAK;AAAA,oBAAQ,MAAK;AAAA,oBAAmB,IAAG;AAAA,oBAAA,uBAAA,OAAA,CAAA,MAAA,OAAA,CAAA,IAAA,CAAA,WAC7D,OAAA,YAAS;AAAA,oBACjB,OAAO;AAAA,kBAAA,GAAA,MAAA,GAAA,GAAA;AAAA,kCADC,OAAA,SAAS;AAAA,kBAAA,CAAA;AAAA;4CAEpBA,mBAEQ,SAAA;AAAA,oBAFD,OAAM;AAAA,oBAAmB,KAAI;AAAA,kBAAA,GAAkB,+CAEtD,EAAA;AAAA,gBAAA,CAAA;AAAA;gBAEFA,mBAOM,OAPN,aAOM;AAAA,kBAAAI,eANJJ,mBAEiB,SAAA;AAAA,oBAFV,OAAM;AAAA,oBAAmB,MAAK;AAAA,oBAAQ,MAAK;AAAA,oBAAmB,IAAG;AAAA,oBAAA,uBAAA,OAAA,CAAA,MAAA,OAAA,CAAA,IAAA,CAAA,WAC7D,OAAA,YAAS;AAAA,oBACjB,OAAO;AAAA,kBAAA,GAAA,MAAA,GAAA,GAAA;AAAA,kCADC,OAAA,SAAS;AAAA,kBAAA,CAAA;AAAA;8CAEpBA,mBAEQ,SAAA;AAAA,oBAFD,OAAM;AAAA,oBAAmB,KAAI;AAAA,kBAAA,GAAmB,gDAEvD,EAAA;AAAA,gBAAA,CAAA;AAAA;;cAIJA,mBAA8F,SAAA;AAAA,gBAAvF,MAAK;AAAA,gBAAS,OAAM;AAAA,gBAAwB,MAAK;AAAA,gBAAoB,OAAO,OAAA;AAAA,cAAA,GAAA,MAAA,GAAA,WAAA;AAAA;cAGnFA,mBAUM,OAVN,aAUM;AAAA,gBATJA,mBAIS,UAAA;AAAA,kBAJD,MAAK;AAAA,kBAAS,OAAM;AAAA,kBACzB,UAAU,OAAA;AAAA,kBACV,SAAK,OAAA,CAAA,MAAA,OAAA,CAAA,IAAA,IAAA,SAAE,OAAA,UAAA,OAAA,OAAA,GAAA,IAAA;AAAA,gBAAA,GAAQ,0CAElB,GAAA,WAAA;AAAA,gBAAA,OAAA,EAAA,MAAA,OAAA,EAAA,IAAAC,gBAAA;AAAA,gBACAD,mBAGS,UAAA;AAAA,kBAHD,MAAK;AAAA,kBAAS,OAAM;AAAA,kBAA0B,mBAAgB;AAAA,kBACnE,UAAU,OAAA;AAAA,gBAAA,GAAS,2CAEtB,GAAA,WAAA;AAAA,cAAA,CAAA;AAAA;;;;;;;;AC1Kd,eAAsB,yBAAyB,OAA4B;AACzE,QAAM,MAAM,UAAU,oBAAoB,KAAK;AAE/C,SAAO;AACT;"}