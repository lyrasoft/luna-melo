{"version":3,"file":"BasicQuestionProcessing.js","sources":["../../src/modules/section-quiz/BasicQuestionProcessing.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useLoading } from '@lyrasoft/ts-toolkit/vue';\nimport { simpleAlert, useHttpClient } from '@windwalker-io/unicorn-next';\nimport { computed } from 'vue';\nimport { useQuestionPresenter } from '~melo/modules/segment-editor/features/question/useQuestionPresenter';\nimport { QnOption, Question } from '~melo/types';\n\nconst props = defineProps<{\n  index: number;\n  question: Question;\n}>();\n\nconst answer = defineModel<any>({\n  required: true,\n});\n\nconst type = computed(() => props.question.type);\n\nif (answer.value == null) {\n  if (type.value === 'select') {\n    answer.value = '';\n  } else if (type.value === 'multiple') {\n    answer.value = [];\n  } else if (type.value === 'boolean') {\n    answer.value = null;\n  }\n}\n\nconst { typeToTitle } = useQuestionPresenter();\n\nconst options = computed<QnOption[]>(() => {\n  if (type.value === 'select') {\n    return props.question.params.options || [];\n  } else if (type.value === 'multiple') {\n    return props.question.params.options || [];\n  }\n\n  return [];\n});\n\nfunction getQuestionInputName(question: Question, suffix = '') {\n  return `quiz[${question.id}]${suffix}`;\n}\n\nfunction toggleMultiple(e: Event, option: QnOption) {\n  const target = e.target as HTMLInputElement;\n\n  if (target.checked) {\n    answer.value = [...answer.value, option.text];\n  } else {\n    answer.value = (answer.value as any[]).filter((ans) => ans !== option.text);\n  }\n}\n\n// Submit\nconst { loading, wrap } = useLoading();\n\nconst submit = wrap(async () => {\n  const { post } = await useHttpClient();\n\n  const formData = new FormData();\n\n  for (const k in answer.value) {\n    const ans = answer.value[k];\n\n    formData.append(`quiz[${k}]`, ans);\n  }\n\n  try {\n    await post(\n      '@ajax_lesson/submitQuiz',\n      formData,\n    );\n\n    await simpleAlert('測驗提交成功！', '', 'success');\n\n    location.reload();\n  } catch (e) {\n    console.error(e);\n\n    if (e instanceof Error) {\n      simpleAlert('測驗提交失敗！', e.message, 'warning');\n    }\n  }\n});\n</script>\n\n<template>\n  <div class=\"c-question-item\">\n    <div class=\"h6 mb-1\">\n      第 {{ index }} 題（{{ typeToTitle(question.type) }}）:<br>\n      {{ question.title }}\n    </div>\n    <div class=\"mb-3\" v-html=\"question.content\">\n\n    </div>\n    <div>\n\n      <template v-if=\"type === 'select'\">\n        <div class=\"d-flex flex-column gap-2\">\n          <div class=\"form-check\" v-for=\"(option, idx) in options\" :key=\"idx\">\n            <input\n              class=\"form-check-input\"\n              type=\"radio\"\n              :id=\"'question-' + question.id + '-option-' + idx\"\n              :value=\"option.text\"\n              :name=\"getQuestionInputName(question)\"\n              v-model=\"answer\"\n            >\n            <label\n              class=\"form-check-label\"\n              :for=\"'question-' + question.id + '-option-' + idx\"\n            >{{ option.text }}</label>\n          </div>\n        </div>\n      </template>\n\n      <template v-else-if=\"type === 'multiple'\">\n        <div class=\"d-flex flex-column gap-2\">\n          <div class=\"form-check\" v-for=\"(option, idx) in options\" :key=\"idx\">\n            <input\n              class=\"form-check-input\"\n              type=\"checkbox\"\n              :id=\"`question-${question.id}-option-${idx}`\"\n              :name=\"getQuestionInputName(question, '[]')\"\n              :value=\"option.text\"\n              :checked=\"Array.isArray(answer) && answer.includes(option.text)\"\n              @change=\"toggleMultiple($event, option)\"\n            >\n            <label\n              class=\"form-check-label\"\n              :for=\"'question-' + question.id + '-option-' + idx\"\n            >{{ option.text }}</label>\n          </div>\n        </div>\n      </template>\n\n      <template v-else-if=\"type === 'boolean'\">\n        <div class=\"d-flex flex-column gap-2\">\n          <div class=\"form-check\">\n            <input\n              class=\"form-check-input\"\n              type=\"radio\"\n              :id=\"'question-' + question.id + '-option-yes'\"\n              :name=\"getQuestionInputName(question)\"\n              value=\"1\"\n              v-model=\"answer\"\n            >\n            <label\n              class=\"form-check-label\"\n              :for=\"'question-' + question.id + '-option-yes'\"\n            >\n              是\n            </label>\n          </div>\n\n          <div class=\"form-check\">\n            <input\n              class=\"form-check-input\"\n              type=\"radio\"\n              :id=\"'question-' + question.id + '-option-no'\"\n              :name=\"getQuestionInputName(question)\"\n              value=\"0\"\n              v-model=\"answer\"\n            >\n            <label\n              class=\"form-check-label\"\n              :for=\"'question-' + question.id + '-option-no'\"\n            >\n              否\n            </label>\n          </div>\n        </div>\n      </template>\n\n    </div>\n  </div>\n</template>\n\n<style scoped>\n\n</style>\n"],"names":["_useModel","_openBlock","_createElementBlock","_createElementVNode","_createTextVNode","_toDisplayString","_Fragment","_renderList","_withDirectives"],"mappings":"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"}