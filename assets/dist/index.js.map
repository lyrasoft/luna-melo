{"version":3,"file":"index.js","sources":["../src/features/lesson/useLessonCartButtons.ts","../src/features/section/useSectionEditComponents.ts","../src/features/question/useQuestionEditComponents.ts","../src/index.ts"],"sourcesContent":["import { delegate, route, simpleAlert, useHttpClient } from '@windwalker-io/unicorn-next';\r\n\r\nexport function useLessonCartButtons(selector = '[data-task=buy]') {\r\n  listen(selector);\r\n\r\n  return {\r\n    off,\r\n    buy,\r\n    toCartPage,\r\n    sendAddAction,\r\n  };\r\n}\r\n\r\nlet isListening = false;\r\n\r\nfunction buttonClicked(e: Event)  {\r\n  buy(e.currentTarget as HTMLElement);\r\n}\r\n\r\nfunction listen(selector = '[data-task=buy]') {\r\n  if (isListening) {\r\n    return;\r\n  }\r\n\r\n  isListening = true;\r\n\r\n  delegate(document.body, selector, 'click', buttonClicked);\r\n}\r\n\r\nfunction off() {\r\n  document.body.removeEventListener('click', buttonClicked);\r\n\r\n  isListening = false;\r\n}\r\n\r\nasync function sendAddAction(el: HTMLElement) {\r\n  const lessonId = el.dataset.id;\r\n\r\n  if (!lessonId) {\r\n    throw new Error('No lesson ID');\r\n  }\r\n\r\n  const { post } = await useHttpClient();\r\n\r\n  try {\r\n    const res = await post(\r\n      '@melo_cart_ajax/addToCart',\r\n      {\r\n        id: lessonId,\r\n      }\r\n    );\r\n\r\n    return res.data;\r\n  } catch (e) {\r\n    console.error(e);\r\n    throw e;\r\n  }\r\n}\r\n\r\nasync function buy(el: HTMLElement) {\r\n  const { isAxiosError } = await useHttpClient();\r\n\r\n  try {\r\n    await sendAddAction(el);\r\n  } catch (e) {\r\n    if (isAxiosError(e)) {\r\n      simpleAlert(e.message, '', 'warning');\r\n    }\r\n    return;\r\n  }\r\n\r\n  toCartPage();\r\n}\r\n\r\nfunction toCartPage() {\r\n  location.href = route('melo_cart');\r\n}\r\n","\r\ntype ModuleImportCallback = () => Promise<any>;\r\n\r\nconst sectionEditComponents: Record<string, ModuleImportCallback> = {\r\n  video: () => import('~melo/components/segment-edit/section/SectionVideoEdit.vue'),\r\n  homework: () => import('~melo/components/segment-edit/section/SectionHomeworkEdit.vue'),\r\n  quiz: () => import('~melo/components/segment-edit/section/SectionQuizEdit.vue'),\r\n}\r\n\r\nexport function useSectionEditComponents(): Record<string, ModuleImportCallback>;\r\nexport function useSectionEditComponents(id: string, component: ModuleImportCallback): Record<string, ModuleImportCallback>;\r\nexport function useSectionEditComponents(id: Record<string, ModuleImportCallback>): Record<string, ModuleImportCallback>;\r\nexport function useSectionEditComponents(id?: string | Record<string, ModuleImportCallback>, component?: ModuleImportCallback) {\r\n  if (typeof id === 'object') {\r\n    Object.assign(sectionEditComponents, id);\r\n  } else if (component && typeof id === 'string') {\r\n    sectionEditComponents[id] = component;\r\n  }\r\n\r\n  return sectionEditComponents;\r\n}\r\n\r\n","\r\ntype ModuleImportCallback = () => Promise<any>;\r\n\r\nconst questionEditComponents: Record<string, ModuleImportCallback> = {\r\n  boolean: () => import('~melo/components/segment-edit/question/QuestionEdit.vue'),\r\n  select: () => import('~melo/components/segment-edit/question/QuestionEdit.vue'),\r\n  multiple: () => import('~melo/components/segment-edit/question/QuestionEdit.vue'),\r\n}\r\n\r\nexport function useQuestionEditComponents(): Record<string, ModuleImportCallback>;\r\nexport function useQuestionEditComponents(id: string, component: ModuleImportCallback): Record<string, ModuleImportCallback>;\r\nexport function useQuestionEditComponents(id: Record<string, ModuleImportCallback>): Record<string, ModuleImportCallback>;\r\nexport function useQuestionEditComponents(id?: string | Record<string, ModuleImportCallback>, component?: ModuleImportCallback) {\r\n  if (typeof id === 'object') {\r\n    Object.assign(questionEditComponents, id);\r\n  } else if (component && typeof id === 'string') {\r\n    questionEditComponents[id] = component;\r\n  }\r\n\r\n  return questionEditComponents;\r\n}\r\n\r\n","import { useMacro } from '@windwalker-io/unicorn-next';\r\nimport { useLessonCartButtons } from '~melo/features/lesson/useLessonCartButtons';\r\n\r\nexport * from '~melo/features/lesson/useLessonCartButtons';\r\nexport * from '~melo/features/section/useSectionEditComponents';\r\nexport * from '~melo/features/question/useQuestionEditComponents';\r\nexport * from '~melo/types';\r\n\r\nexport function useMeloFrontLessons() {\r\n  return useMacro('$melo', {\r\n    useLessonCartButtons,\r\n  });\r\n}\r\n\r\nexport async function createSegmentEditorApp(props: Record<string, any>) {\r\n  const { createSegmentEditorApp } = await import('~melo/segment-editor');\r\n\r\n  return createSegmentEditorApp(props);\r\n}\r\n\r\nexport async function createMeloCartApp(props: Record<string, any>) {\r\n  const { createMeloCartApp } = await import('~melo/melo-cart');\r\n\r\n  return createMeloCartApp(props);\r\n}\r\n"],"names":["createSegmentEditorApp","createMeloCartApp"],"mappings":";AAEO,SAAS,qBAAqB,WAAW,mBAAmB;AACjE,SAAO,QAAQ;AAEf,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;AAEA,IAAI,cAAc;AAElB,SAAS,cAAc,GAAW;AAChC,MAAI,EAAE,aAA4B;AACpC;AAEA,SAAS,OAAO,WAAW,mBAAmB;AAC5C,MAAI,aAAa;AACf;AAAA,EACF;AAEA,gBAAc;AAEd,WAAS,SAAS,MAAM,UAAU,SAAS,aAAa;AAC1D;AAEA,SAAS,MAAM;AACb,WAAS,KAAK,oBAAoB,SAAS,aAAa;AAExD,gBAAc;AAChB;AAEA,eAAe,cAAc,IAAiB;AAC5C,QAAM,WAAW,GAAG,QAAQ;AAE5B,MAAI,CAAC,UAAU;AACb,UAAM,IAAI,MAAM,cAAc;AAAA,EAChC;AAEA,QAAM,EAAE,SAAS,MAAM,cAAA;AAEvB,MAAI;AACF,UAAM,MAAM,MAAM;AAAA,MAChB;AAAA,MACA;AAAA,QACE,IAAI;AAAA,MAAA;AAAA,IACN;AAGF,WAAO,IAAI;AAAA,EACb,SAAS,GAAG;AACV,YAAQ,MAAM,CAAC;AACf,UAAM;AAAA,EACR;AACF;AAEA,eAAe,IAAI,IAAiB;AAClC,QAAM,EAAE,iBAAiB,MAAM,cAAA;AAE/B,MAAI;AACF,UAAM,cAAc,EAAE;AAAA,EACxB,SAAS,GAAG;AACV,QAAI,aAAa,CAAC,GAAG;AACnB,kBAAY,EAAE,SAAS,IAAI,SAAS;AAAA,IACtC;AACA;AAAA,EACF;AAEA,aAAA;AACF;AAEA,SAAS,aAAa;AACpB,WAAS,OAAO,MAAM,WAAW;AACnC;ACzEA,MAAM,wBAA8D;AAAA,EAClE,OAAO,MAAM,OAAO,8BAA4D;AAAA,EAChF,UAAU,MAAM,OAAO,iCAA+D;AAAA,EACtF,MAAM,MAAM,OAAO,6BAA2D;AAChF;AAKO,SAAS,yBAAyB,IAAoD,WAAkC;AAC7H,MAAI,OAAO,OAAO,UAAU;AAC1B,WAAO,OAAO,uBAAuB,EAAE;AAAA,EACzC,WAAW,aAAa,OAAO,OAAO,UAAU;AAC9C,0BAAsB,EAAE,IAAI;AAAA,EAC9B;AAEA,SAAO;AACT;ACjBA,MAAM,yBAA+D;AAAA,EACnE,SAAS,MAAM,OAAO,0BAAyD,EAAA,KAAA,OAAA,EAAA,CAAA;AAAA,EAC/E,QAAQ,MAAM,OAAO,0BAAyD,EAAA,KAAA,OAAA,EAAA,CAAA;AAAA,EAC9E,UAAU,MAAM,OAAO,0BAAyD,EAAA,KAAA,OAAA,EAAA,CAAA;AAClF;AAKO,SAAS,0BAA0B,IAAoD,WAAkC;AAC9H,MAAI,OAAO,OAAO,UAAU;AAC1B,WAAO,OAAO,wBAAwB,EAAE;AAAA,EAC1C,WAAW,aAAa,OAAO,OAAO,UAAU;AAC9C,2BAAuB,EAAE,IAAI;AAAA,EAC/B;AAEA,SAAO;AACT;ACZO,SAAS,sBAAsB;AACpC,SAAO,SAAS,SAAS;AAAA,IACvB;AAAA,EAAA,CACD;AACH;AAEA,eAAsB,uBAAuB,OAA4B;AACvE,QAAM,EAAE,wBAAAA,4BAA2B,MAAM,OAAO,4BAAsB;AAEtE,SAAOA,wBAAuB,KAAK;AACrC;AAEA,eAAsB,kBAAkB,OAA4B;AAClE,QAAM,EAAE,mBAAAC,uBAAsB,MAAM,OAAO,uBAAiB;AAE5D,SAAOA,mBAAkB,KAAK;AAChC;"}