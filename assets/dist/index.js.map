{"version":3,"file":"index.js","sources":["../src/lesson.ts","../src/features/section/useSectionEditComponents.ts","../src/index.ts"],"sourcesContent":["import { delegate, route, simpleAlert, useHttpClient } from '@windwalker-io/unicorn-next';\n\nexport function useLessonPage() {\n  delegate(document.body, '[data-task=buy]', 'click', (e) => {\n    buy(e.currentTarget as HTMLElement);\n  });\n\n  async function sendAddAction(el: HTMLElement) {\n    const lessonId = el.dataset.id;\n\n    if (!lessonId) {\n      throw new Error('No lesson ID');\n    }\n\n    const { post } = await useHttpClient();\n\n    try {\n      const res = await post(\n        '@cart_ajax/addToCart',\n        {\n          id: lessonId,\n        }\n      );\n\n      return res.data;\n    } catch (e) {\n      console.error(e);\n      throw e;\n    }\n  }\n\n  async function buy(el: HTMLElement) {\n    const { isAxiosError } = await useHttpClient();\n\n    try {\n      await sendAddAction(el);\n    } catch (e) {\n      if (isAxiosError(e)) {\n        simpleAlert(e.message, '', 'warning');\n      }\n      return;\n    }\n\n    toCartPage();\n  }\n\n  function toCartPage() {\n    location.href = route('cart');\n  }\n\n  return {\n    buy,\n    toCartPage,\n    sendAddAction,\n  };\n}\n","\ntype ModuleImportCallback = () => Promise<any>;\n\nconst sectionEditComponents: Record<string, ModuleImportCallback> = {\n  video: () => import('~melo/components/segment-edit/section/SectionVideoEdit.vue'),\n  homework: () => import('~melo/components/segment-edit/section/SectionHomeworkEdit.vue'),\n  quiz: () => import('~melo/components/segment-edit/section/SectionQuizEdit.vue'),\n}\n\nexport function useSectionEditComponents(): Record<string, ModuleImportCallback>;\nexport function useSectionEditComponents(id: string, component: ModuleImportCallback): Record<string, ModuleImportCallback>;\nexport function useSectionEditComponents(id: Record<string, ModuleImportCallback>): Record<string, ModuleImportCallback>;\nexport function useSectionEditComponents(id?: string | Record<string, ModuleImportCallback>, component?: ModuleImportCallback) {\n  if (typeof id === 'object') {\n    Object.assign(sectionEditComponents, id);\n  } else if (component && typeof id === 'string') {\n    sectionEditComponents[id] = component;\n  }\n\n  return sectionEditComponents;\n}\n\n","\nexport * from '~melo/lesson';\nexport * from '~melo/features/section/useSectionEditComponents';\n\nexport async function createSegmentEditorApp(props: Record<string, any>) {\n  const { createSegmentEditorApp } = await import('~melo/segment-editor');\n\n  return createSegmentEditorApp(props);\n}\n"],"names":["createSegmentEditorApp"],"mappings":";AAEO,SAAS,gBAAgB;AAC9B,WAAS,SAAS,MAAM,mBAAmB,SAAS,CAAC,MAAM;AACzD,QAAI,EAAE,aAA4B;AAAA,EACpC,CAAC;AAED,iBAAe,cAAc,IAAiB;AAC5C,UAAM,WAAW,GAAG,QAAQ;AAE5B,QAAI,CAAC,UAAU;AACb,YAAM,IAAI,MAAM,cAAc;AAAA,IAChC;AAEA,UAAM,EAAE,SAAS,MAAM,cAAA;AAEvB,QAAI;AACF,YAAM,MAAM,MAAM;AAAA,QAChB;AAAA,QACA;AAAA,UACE,IAAI;AAAA,QAAA;AAAA,MACN;AAGF,aAAO,IAAI;AAAA,IACb,SAAS,GAAG;AACV,cAAQ,MAAM,CAAC;AACf,YAAM;AAAA,IACR;AAAA,EACF;AAEA,iBAAe,IAAI,IAAiB;AAClC,UAAM,EAAE,iBAAiB,MAAM,cAAA;AAE/B,QAAI;AACF,YAAM,cAAc,EAAE;AAAA,IACxB,SAAS,GAAG;AACV,UAAI,aAAa,CAAC,GAAG;AACnB,oBAAY,EAAE,SAAS,IAAI,SAAS;AAAA,MACtC;AACA;AAAA,IACF;AAEA,eAAA;AAAA,EACF;AAEA,WAAS,aAAa;AACpB,aAAS,OAAO,MAAM,MAAM;AAAA,EAC9B;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;ACpDA,MAAM,wBAA8D;AAAA,EAClE,OAAO,MAAM,OAAO,8BAA4D;AAAA,EAChF,UAAU,MAAM,OAAO,iCAA+D;AAAA,EACtF,MAAM,MAAM,OAAO,6BAA2D;AAChF;AAKO,SAAS,yBAAyB,IAAoD,WAAkC;AAC7H,MAAI,OAAO,OAAO,UAAU;AAC1B,WAAO,OAAO,uBAAuB,EAAE;AAAA,EACzC,WAAW,aAAa,OAAO,OAAO,UAAU;AAC9C,0BAAsB,EAAE,IAAI;AAAA,EAC9B;AAEA,SAAO;AACT;AChBA,eAAsB,uBAAuB,OAA4B;AACvE,QAAM,EAAE,wBAAAA,4BAA2B,MAAM,OAAO,4BAAsB;AAEtE,SAAOA,wBAAuB,KAAK;AACrC;"}